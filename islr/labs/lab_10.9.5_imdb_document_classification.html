

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lab 10.9.5: IMDb Document Classification &#8212; Data Science Foundation in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'islr/labs/lab_10.9.5_imdb_document_classification';</script>
    <link rel="canonical" href="https://jads-nl.github.io/data-science-foundation-curriculum/islr/labs/lab_10.9.5_imdb_document_classification.html" />
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 10.9.6: Recurrent Neural Networks" href="lab_10.9.6_recurrent_neural_networks.html" />
    <link rel="prev" title="Lab 10.9.3: Convolutional Neural Networks" href="lab_10.9.3_convolutional_neural_networks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Data Science Foundation in Python</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Why this JupyterBook?
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to Statistical Learning</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to ISLRv2</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../labs.html">Labs</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lab_02.3_introduction.html">Lab 2.3: Introduction to Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_03.6_linear_regression.html">Lab 3.6: Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_04.7_classification_methods.html">Lab 4.7: Classification Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_05.3_cross_validation_and_the_bootstrap.html">Lab 5.3: Cross-Validation and the Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_06.5.1_subset_selection_methods.html">Lab 6.5.1: Subset Selection Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_06.5.2_ridge_regression_and_the_lasso.html">Lab 6.5.2: Ridge Regression and the Lasso</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_06.5.3_pcr_and_pls_regression.html">Lab 6.5.3: PCR and PLS Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_07.8_non_linear_modelling.html">Lab 7.8: Non-linear Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_08.3_decision_trees.html">Lab 8.3: Decision Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_09.6_support_vector_machines.html">Lab 9.6: Support Vector Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_10.9.2_multilayer_network_on_mnist_digit_data.html">Lab 10.9.2: A Multilayer Network on the MNIST Digit Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_10.9.3_convolutional_neural_networks.html">Lab 10.9.3: Convolutional Neural Networks</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Lab 10.9.5: IMDb Document Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_10.9.6_recurrent_neural_networks.html">Lab 10.9.6: Recurrent Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_12.5_unsupervised_learning.html">Lab 12.5: Unsupervised Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exercises.html">Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter2/index.html">Chapter 2</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise1.html">Exercise 2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise2.html">Exercise 2.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise3.html">Exercise 2.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise4.html">Exercise 2.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise5.html">Exercise 2.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise6.html">Exercise 2.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise7.html">Exercise 2.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise8.html">Exercise 2.8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise9.html">Exercise 2.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter2/exercise10.html">Exercise 2.10</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter3/index.html">Chapter 3</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise1.html">Exercise 3.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise2.html">Exercise 3.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise3.html">Exercise 3.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise4.html">Exercise 3.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise5.html">Exercise 3.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise6.html">Exercise 3.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise7.html">Exercise 3.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise8.html">Exercise 3.8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise9.html">Exercise 3.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise10.html">Exercise 3.10</a></li>






<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise11.html">Exercise 3.11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise12.html">Exercise 3.12</a></li>



<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise13.html">Exercise 3.13</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise14.html">Exercise 3.14</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter3/exercise15.html">Exercise 3.15</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter4/index.html">Chapter 4</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise1.html">Exercise 4.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise2.html">Exercise 4.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise3.html">Exercise 4.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise4.html">Exercise 4.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise5.html">Exercise 4.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise6.html">Exercise 4.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise7.html">Exercise 4.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise8.html">Exercise 4.8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise9.html">Exercise 4.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise10.html">Exercise 10</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise11.html">Exercise 11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise12.html">Exercise 12</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise13.html">Exercise 4.13</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise14.html">Exercise 4.11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise15.html">Exercise 4.12</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter4/exercise16.html">Exercise 4.16</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter5/index.html">Chapter 5</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise1.html">Exercise 5.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise2.html">Exercise 5.2</a></li>








<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise3.html">Problem 5.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise4.html">Exercise 5.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise5.html">Exercise 5.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise6.html">Exercise 5.6</a></li>





<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise7.html">Exercise 5.7</a></li>





<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise8.html">Exercise 5.8</a></li>







<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter5/exercise9.html">Exercise 5.9</a></li>








</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter6/index.html">Chapter 6</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise1.html">Exercise 6.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise2.html">Exercise 6.2</a></li>



<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise3.html">Exercise 6.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise4.html">Exercise 6.4</a></li>





<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise5.html">Exercise 6.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise6.html">Exercise 6.6</a></li>


<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise7.html">Exercise 6.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise8.html">Exercise 6.8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise9.html">Exercise 6.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise10.html">Exercise 6.10</a></li>







<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter6/exercise11.html">Exercise 6.11</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter7/index.html">Chapter 7</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise1.html">Exercise 7.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise2.html">Exercise 7.2</a></li>





<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise3.html">Exercise 7.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise4.html">Exercise 7.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise5.html">Exercise 7.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise6.html">Exercise 7.6</a></li>



<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise7.html">Exercise 7.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise8.html">Exercise 7.8</a></li>





<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise9.html">Exercise 7.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise10.html">Exercise 7.10</a></li>


<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise11.html">Exercise 7.11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter7/exercise12.html">Exercise 7.12</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter8/index.html">Chapter 8</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise1.html">Exercise 8.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise2.html">Exercise 8.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise3.html">Exercise 8.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise4.html">Exercise 8.4</a></li>


<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise5.html">Exercise 8.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise6.html">Exercise 8.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise7.html">Exercise 8.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise8.html">Exercise 8.8</a></li>







<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise9.html">Exercise 8.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise10.html">Exercise 8.10</a></li>







<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise11.html">Exercise 8.11</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter8/exercise12.html">Exercise 8.12</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter9/index.html">Chapter 9</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise1.html">Exercise 9.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise2.html">Exercise 9.2</a></li>




<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise3.html">Exercise 9.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise4.html">Exercise 9.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise5.html">Exercise 9.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise6.html">Exercise 9.6</a></li>



<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise7.html">Exercise 9.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter9/exercise8.html">Exercise 9.8</a></li>








</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exercises/chapter12/index.html">Chapter 12</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise1.html">Exercise 12.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise2.html">Exercise 12.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise3.html">Exercise 12.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise4.html">Exercise 12.4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise5.html">Exercise 12.5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise6.html">Exercise 12.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise7.html">Exercise 12.7</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise8.html">Exercise 10.8</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise9.html">Exercise 12.9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise10.html">Exercise 12.10</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exercises/chapter12/exercise11.html">Exercise 12.11</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Hands-on Machine Learning in Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../handson-ml2/introduction.html">Hands-on Machine Learning with Aurélien Géron</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/01_the_machine_learning_landscape.html">Chapter 1 – The Machine Learning landscape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/02_end_to_end_machine_learning_project.html">Chapter 2 – End-to-end Machine Learning project</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/03_classification.html">Chapter 3 – Classification</a></li>










<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/04_training_linear_models.html">Chapter 4 – Training Models</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/05_support_vector_machines.html">Chapter 5 – Support Vector Machines</a></li>









<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/06_decision_trees.html">Chapter 6 – Decision Trees</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/07_ensemble_learning_and_random_forests.html">Chapter 7 – Ensemble Learning and Random Forests</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/08_dimensionality_reduction.html">Chapter 8 – Dimensionality Reduction</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/09_unsupervised_learning.html">Chapter 9 – Unsupervised Learning</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/10_neural_nets_with_keras.html">Chapter 10 – Introduction to Artificial Neural Networks with Keras</a></li>












<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/11_training_deep_neural_networks.html">Chapter 11 – Training Deep Neural Networks</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/12_custom_models_and_training_with_tensorflow.html">Chapter 12 – Custom Models and Training with TensorFlow</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/13_loading_and_preprocessing_data.html">Chapter 13 – Loading and Preprocessing Data with TensorFlow</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/14_deep_computer_vision_with_cnns.html">Chapter 14 – Deep Computer Vision Using Convolutional Neural Networks</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/15_processing_sequences_using_rnns_and_cnns.html">Chapter 15 – Processing Sequences Using RNNs and CNNs</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/16_nlp_with_rnns_and_attention.html">Chapter 16 – Natural Language Processing with RNNs and Attention**</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/17_autoencoders_and_gans.html">Chapter 17 – Autoencoders and GANs**</a></li>












<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/18_reinforcement_learning.html">Chapter 18 – Reinforcement Learning</a></li>














<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/19_training_and_deploying_at_scale.html">Chapter 19 – Training and Deploying TensorFlow Models at Scale</a></li>








</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../handson-ml2/extra.html">Miscellaneous tips &amp; tricks</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/math_linear_algebra.html">Math primer - Linear Algebra</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/math_differential_calculus.html">Math primer - Differential Calculus</a></li>











<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/extra_autodiff.html">Implementation of autodiff techniques</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../handson-ml2/original/extra_gradient_descent_comparison.html">Comparison of Batch, Mini-Batch and Stochastic Gradient Descent</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data visualization with Altair</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../visualization/introduction.html">Data visualization with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization/introduction-to-interactive-data-visualization.html">Introduction to data visualization with Python</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../visualization/altair_get_started.html">Getting Started with Altair</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_introduction.html">Introduction to Altair</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_marks_encoding.html">Data Types, Graphical Marks, and Visual Encoding Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_data_transformation.html">Data Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_scales_axes_legends.html">Scales, Axes, and Legends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_view_composition.html">Multi-View Composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_interaction.html">Interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_cartographic.html">Cartographic Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization/altair_debugging.html">Altair Debugging Guide</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Interpretable Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../iml/introduction.html">Introduction to IML</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../iml/plot_partial_dependence.html">Partial Dependence and Individual Conditional Expectation Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iml/plot_permutation_importance.html">Permutation Importance vs Random Forest Feature Importance (MDI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iml/plot_permutation_importance_multicollinear.html">Permutation Importance with Multicollinear or Correlated Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iml/interpreting-machine-learning-models.html">IML with Pima Indians and the Titanic datasets</a></li>







</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Principles of time-series forecasting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../fpp/introduction.html">Introduction to FPP3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpp/examples-time-series-forecasting-with-python.html">Examples of time-series forecasting with Python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Natural language processing with spaCy</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../nlp/introduction.html">Introduction to NLP with spaCy</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../nlp/dutch-restaurant-reviews.html">Dutch restaurant reviews</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../nlp/nlp-dutch-restaurant-reviews.html">Analyzing Dutch restaurant reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp/prepare-restoreviews-dataset.html">Fetch and prepare reviews</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp/nlp-pipeline-example.html">Objective</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../nlp/language-detection-with-character-quadgrams.html">Extra: language detection with character quadgrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp/nlp-model-sizes.html">Extra: plot of transformer model sizes</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/jads-nl/data-science-foundation-in-python/blob/main/data_science_foundation_in_python/islr/labs/lab_10.9.5_imdb_document_classification.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jads-nl/data-science-foundation-in-python" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jads-nl/data-science-foundation-in-python/issues/new?title=Issue%20on%20page%20%2Fislr/labs/lab_10.9.5_imdb_document_classification.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/islr/labs/lab_10.9.5_imdb_document_classification.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 10.9.5: IMDb Document Classification</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution">Attribution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-spare-binary-matrices">Using spare binary matrices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-lasso-logistic-regression">Fit Lasso Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-two-layer-feedforward-network">Build a two-layer feedforward network</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-10-9-5-imdb-document-classification">
<h1>Lab 10.9.5: IMDb Document Classification<a class="headerlink" href="#lab-10-9-5-imdb-document-classification" title="Permalink to this heading">#</a></h1>
<section id="attribution">
<h2>Attribution<a class="headerlink" href="#attribution" title="Permalink to this heading">#</a></h2>
<p>This notebook follows lab 10.9.5 from ISLRv2. The R-code has been ported to Python by Daniel Kapitan (23-01-2022).</p>
</section>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h2>
<p>We perform document classification on the IMDb dataset, which is available as part of the <code class="docutils literal notranslate"><span class="pre">tensorflow.keras</span></code> package. We limit the dictionary size to the 10,000 most frequently-used words and tokens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.datasets</span> <span class="kn">import</span> <span class="n">imdb</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>


<span class="c1"># let&#39;s keep our keras backend tensorflow quiet</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;TF_CPP_MIN_LOG_LEVEL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span>

<span class="c1"># load the data</span>
<span class="n">MAX_FEATURES</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">imdb</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">MAX_FEATURES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-11-11 11:35:35.472964: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2023-11-11 11:35:35.510274: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2023-11-11 11:35:35.512344: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-11-11 11:35:36.280682: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/imdb.npz
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    8192/17464789 [..............................] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 4202496/17464789 [======&gt;.......................] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
10723328/17464789 [=================&gt;............] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
15704064/17464789 [=========================&gt;....] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
17464789/17464789 [==============================] - 0s 0us/step
</pre></div>
</div>
</div>
</div>
<p>The last line is a shortcut for unpacking the list of lists. Each element of <code class="docutils literal notranslate"><span class="pre">X_train</span></code> is a vector of numbers between 0 and 9999 (the document), referring to the words found in the dictionary. For example, the first training document is the positive review on page 419 of ISLRv2. The indices of the first 12 words are given below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 194, 1153, 194, 8255, 78, 228, 5, 6, 1463, 4369, 5012]
</pre></div>
</div>
</div>
</div>
<p>To see the words, we create a function, <code class="docutils literal notranslate"><span class="pre">decode_review()</span></code>, that provides a simple interface to the dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_index</span> <span class="o">=</span> <span class="n">imdb</span><span class="o">.</span><span class="n">get_word_index</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">decode_review</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">word_index</span><span class="o">=</span><span class="n">word_index</span><span class="p">,</span> <span class="n">start_char</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">oov_char</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">index_from</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decodes one-hot encoded reviews from IMDb.</span>
<span class="sd">    </span>
<span class="sd">    Note default values for `imdb.load_data`, see https://keras.io/api/datasets/imdb/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reverse_word_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span> <span class="o">+</span> <span class="n">index_from</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">word_index</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># add special tags</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;&lt;PAD&gt;&quot;</span><span class="p">,</span> <span class="n">start_char</span><span class="p">:</span> <span class="s2">&quot;&lt;START&gt;&quot;</span><span class="p">,</span> <span class="n">oov_char</span><span class="p">:</span> <span class="s2">&quot;&lt;UNK&gt;&quot;</span><span class="p">}</span>
    <span class="n">reverse_word_index</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">tags</span><span class="p">,</span> <span class="o">**</span><span class="n">reverse_word_index</span><span class="p">}</span>

    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">reverse_word_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;&lt;index not found&gt;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">])</span>


<span class="n">decode_review</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/imdb_word_index.json
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   8192/1641221 [..............................] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1641221/1641221 [==============================] - 0s 0us/step
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;&lt;START&gt; this film was just brilliant casting location scenery story direction everyone&#39;s really suited the part they played and you could just imagine being there robert &lt;UNK&gt; is an amazing actor and now the same being director &lt;UNK&gt; father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for &lt;UNK&gt; and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also &lt;UNK&gt; to the two little boy&#39;s that played the &lt;UNK&gt; of norman and paul they were just brilliant children are often left out of the &lt;UNK&gt; list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&#39;t you think the whole story was so lovely because it was true and was someone&#39;s life after all that was shared with us all&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-spare-binary-matrices">
<h2>Using spare binary matrices<a class="headerlink" href="#using-spare-binary-matrices" title="Permalink to this heading">#</a></h2>
<p>Next we write a function to “one-hot” encode each document in a list of documents, and return a binary matrix in sparse-matrix format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">one_hot_encode</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="n">MAX_FEATURES</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; One-hot encodes IMDb reviews as SciPy sparse matrix.</span>
<span class="sd">    </span>
<span class="sd">    Using csr_matrix, see https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix</span>
<span class="sd">    For more on sparse matrices, see https://machinelearningmastery.com/sparse-matrices-for-machine-learning/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seqlen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqlen</span><span class="p">)</span>
    <span class="n">row_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">seqlen</span><span class="p">)</span>
    <span class="n">col_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">sequences</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row_index</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dimension</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To construct the matrix, one supplies just the entries that are nonzero. In the last line we call <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix"><code class="docutils literal notranslate"><span class="pre">csr_matrix()</span></code></a> and supply the row indices corresponding to each document and the column indices corresponding to the words in each document. <code class="docutils literal notranslate"><span class="pre">data</span></code> is literally a list of ones. Words that appear more than once in any given document still get recorded as one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_1h</span> <span class="o">=</span> <span class="n">one_hot_encode</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_1h</span> <span class="o">=</span> <span class="n">one_hot_encode</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>

<span class="n">X_train_1h</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(25000, 10000)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO: don&#39;t understand why we get 2.3% non zeros</span>
<span class="n">X_train_1h</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">25_000</span> <span class="o">*</span> <span class="mi">10_000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.023871364
</pre></div>
</div>
</div>
</div>
<p>Only 1.3% of the entries are nonzero, so this amounts to considerable savings in memory. We create a validation set of size 2,000, leaving 23,000 for training.</p>
</section>
<section id="fit-lasso-logistic-regression">
<h2>Fit Lasso Logistic Regression<a class="headerlink" href="#fit-lasso-logistic-regression" title="Permalink to this heading">#</a></h2>
<p>First we fit a lasso logistic regression model using <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LogisticRegression()</span></code> on the training data, and evaluate its performance on the validation data. In order to plot the accuracy as a function of the shrinkage parameter <span class="math notranslate nohighlight">\(\lambda\)</span>, we iterate over different values of <span class="math notranslate nohighlight">\(-log \lambda = [1, 2, .. 20]\)</span>. Note that <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> uses <code class="docutils literal notranslate"><span class="pre">C</span></code> as the regularization parameter, which is the inverse of lambda. Similar espressions compute the performance on the test data, and were used to produce the left plot in Figure 10.11. The code takes advantage of the sparse-matrix format of <code class="docutils literal notranslate"><span class="pre">x_train_1h</span></code>and runs in about two minutes; in the usual dense format it would take about over orders of magnitude longer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ival</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)),</span> <span class="mi">2000</span><span class="p">))</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">ival</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">log_lambda</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">((</span><span class="n">log_lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fitting LogisticRegression with C = </span><span class="si">{</span><span class="n">C</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">models</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">X_train_1h</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fitting LogisticRegression with C = 0.707
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/sklearn/linear_model/_logistic.py:460: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.500
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.354
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.250
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.177
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.125
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.088
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.044
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.031
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.022
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.016
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.011
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.008
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.006
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.004
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.003
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.002
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
fitting LogisticRegression with C = 0.001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... done
CPU times: user 2min 22s, sys: 3min 51s, total: 6min 13s
Wall time: 1min 34s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">accuracy</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_1h</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]))),</span>
        <span class="p">(</span>
            <span class="n">k</span><span class="p">,</span>
            <span class="s2">&quot;validation&quot;</span><span class="p">,</span>
            <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">ival</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_1h</span><span class="p">[</span><span class="n">ival</span><span class="p">,</span> <span class="p">:])),</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">df_lr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">accuracy</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<span class="n">plot_lr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_lr</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_C:Q&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;fold&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span><span class="n">log_C</span><span class="o">=</span><span class="s2">&quot;log(datum.C)&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plot_lr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-9a0225328825472aaca5a85188392fb5.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-9a0225328825472aaca5a85188392fb5.vega-embed details,
  #altair-viz-9a0225328825472aaca5a85188392fb5.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-9a0225328825472aaca5a85188392fb5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9a0225328825472aaca5a85188392fb5") {
      outputDiv = document.getElementById("altair-viz-9a0225328825472aaca5a85188392fb5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.15.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.15.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-d00307840d0bcbe001968aca089b9cba"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"field": "fold", "type": "nominal"}, "x": {"field": "log_C", "type": "quantitative"}, "y": {"field": "accuracy", "type": "quantitative"}}, "transform": [{"calculate": "log(datum.C)", "as": "log_C"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.15.1.json", "datasets": {"data-d00307840d0bcbe001968aca089b9cba": [{"C": 0.7071067811865475, "fold": "train", "accuracy": 0.9907732293697206}, {"C": 0.7071067811865475, "fold": "validation", "accuracy": 0.8745}, {"C": 0.5, "fold": "train", "accuracy": 0.9873510937838423}, {"C": 0.5, "fold": "validation", "accuracy": 0.877}, {"C": 0.35355339059327373, "fold": "train", "accuracy": 0.9830192765865281}, {"C": 0.35355339059327373, "fold": "validation", "accuracy": 0.8775}, {"C": 0.25, "fold": "train", "accuracy": 0.9776911414338315}, {"C": 0.25, "fold": "validation", "accuracy": 0.8805}, {"C": 0.17677669529663687, "fold": "train", "accuracy": 0.9726229153129738}, {"C": 0.17677669529663687, "fold": "validation", "accuracy": 0.884}, {"C": 0.125, "fold": "train", "accuracy": 0.9672514619883041}, {"C": 0.125, "fold": "validation", "accuracy": 0.885}, {"C": 0.08838834764831843, "fold": "train", "accuracy": 0.9612302360840372}, {"C": 0.08838834764831843, "fold": "validation", "accuracy": 0.8865}, {"C": 0.0625, "fold": "train", "accuracy": 0.9548191466320122}, {"C": 0.0625, "fold": "validation", "accuracy": 0.8845}, {"C": 0.044194173824159216, "fold": "train", "accuracy": 0.948104829976175}, {"C": 0.044194173824159216, "fold": "validation", "accuracy": 0.887}, {"C": 0.03125, "fold": "train", "accuracy": 0.9416071041802035}, {"C": 0.03125, "fold": "validation", "accuracy": 0.8875}, {"C": 0.022097086912079608, "fold": "train", "accuracy": 0.9346761966645007}, {"C": 0.022097086912079608, "fold": "validation", "accuracy": 0.889}, {"C": 0.015625, "fold": "train", "accuracy": 0.927745289148798}, {"C": 0.015625, "fold": "validation", "accuracy": 0.8865}, {"C": 0.011048543456039804, "fold": "train", "accuracy": 0.9199480181936323}, {"C": 0.011048543456039804, "fold": "validation", "accuracy": 0.884}, {"C": 0.0078125, "fold": "train", "accuracy": 0.9126705653021443}, {"C": 0.0078125, "fold": "validation", "accuracy": 0.879}, {"C": 0.005524271728019902, "fold": "train", "accuracy": 0.9051765215507905}, {"C": 0.005524271728019902, "fold": "validation", "accuracy": 0.871}, {"C": 0.00390625, "fold": "train", "accuracy": 0.8972926142516786}, {"C": 0.00390625, "fold": "validation", "accuracy": 0.866}, {"C": 0.002762135864009951, "fold": "train", "accuracy": 0.8888455707169157}, {"C": 0.002762135864009951, "fold": "validation", "accuracy": 0.8585}, {"C": 0.001953125, "fold": "train", "accuracy": 0.8815247996534546}, {"C": 0.001953125, "fold": "validation", "accuracy": 0.8535}, {"C": 0.0013810679320049755, "fold": "train", "accuracy": 0.8726878925709335}, {"C": 0.0013810679320049755, "fold": "validation", "accuracy": 0.849}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
</section>
<section id="build-a-two-layer-feedforward-network">
<h2>Build a two-layer feedforward network<a class="headerlink" href="#build-a-two-layer-feedforward-network" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># building a linear stack of layers with the sequential model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>_________________________________________________________________
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Layer (type)                Output Shape              Param #   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=================================================================
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> dense (Dense)               (None, 16)                160016    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> dense_1 (Dense)             (None, 16)                272       
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> dense_2 (Dense)             (None, 1)                 17        
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=================================================================
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total params: 160305 (626.19 KB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trainable params: 160305 (626.19 KB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Non-trainable params: 0 (0.00 Byte)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;rmsprop&#39;</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_1h</span><span class="p">[</span><span class="n">mask</span><span class="p">,:],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_train_1h</span><span class="p">[</span><span class="n">ival</span><span class="p">,:],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">ival</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 1s - loss: 0.4939 - accuracy: 0.7890 - val_loss: 0.3717 - val_accuracy: 0.8580 - 818ms/epoch - 18ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 2/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.3101 - accuracy: 0.8901 - val_loss: 0.3000 - val_accuracy: 0.8820 - 264ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 3/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.2462 - accuracy: 0.9143 - val_loss: 0.2779 - val_accuracy: 0.8900 - 274ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 4/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.2066 - accuracy: 0.9266 - val_loss: 0.3047 - val_accuracy: 0.8840 - 268ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 5/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1792 - accuracy: 0.9380 - val_loss: 0.3094 - val_accuracy: 0.8845 - 267ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 6/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1575 - accuracy: 0.9457 - val_loss: 0.3265 - val_accuracy: 0.8770 - 269ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 7/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1413 - accuracy: 0.9522 - val_loss: 0.3000 - val_accuracy: 0.8830 - 265ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 8/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1277 - accuracy: 0.9562 - val_loss: 0.3129 - val_accuracy: 0.8875 - 266ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 9/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1136 - accuracy: 0.9633 - val_loss: 0.3225 - val_accuracy: 0.8850 - 265ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 10/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.1009 - accuracy: 0.9675 - val_loss: 0.3268 - val_accuracy: 0.8835 - 264ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 11/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0871 - accuracy: 0.9730 - val_loss: 0.3464 - val_accuracy: 0.8845 - 262ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 12/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0805 - accuracy: 0.9742 - val_loss: 0.3676 - val_accuracy: 0.8755 - 267ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 13/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0735 - accuracy: 0.9761 - val_loss: 0.3770 - val_accuracy: 0.8765 - 267ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 14/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0639 - accuracy: 0.9806 - val_loss: 0.4272 - val_accuracy: 0.8770 - 275ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 15/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0543 - accuracy: 0.9847 - val_loss: 0.4777 - val_accuracy: 0.8670 - 275ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 16/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0494 - accuracy: 0.9867 - val_loss: 0.4719 - val_accuracy: 0.8745 - 265ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 17/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0481 - accuracy: 0.9863 - val_loss: 0.4603 - val_accuracy: 0.8745 - 272ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 18/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0373 - accuracy: 0.9903 - val_loss: 0.6295 - val_accuracy: 0.8510 - 275ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 19/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0310 - accuracy: 0.9926 - val_loss: 0.4740 - val_accuracy: 0.8780 - 266ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 20/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0323 - accuracy: 0.9926 - val_loss: 0.5050 - val_accuracy: 0.8760 - 264ms/epoch - 6ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 12.3 s, sys: 1.01 s, total: 13.3 s
Wall time: 6.08 s
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">history</span></code> object has a <code class="docutils literal notranslate"><span class="pre">metrics</span></code> attribute that records both the training and validation accuracy at each epoch. We’ll wrangle it into long-format for plotting with Altair.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;epoch&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">df_mlp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fold</span><span class="o">=</span><span class="s2">&quot;training&quot;</span><span class="p">),</span>
        <span class="n">_</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;val_accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="s2">&quot;loss&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fold</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_mlp</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_mlp</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;epoch:Q&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;,.2f&quot;</span><span class="p">)],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">plot_mlp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
  #altair-viz-2fa964c99e804e6fae4ee25413f81b01.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-2fa964c99e804e6fae4ee25413f81b01.vega-embed details,
  #altair-viz-2fa964c99e804e6fae4ee25413f81b01.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-2fa964c99e804e6fae4ee25413f81b01"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2fa964c99e804e6fae4ee25413f81b01") {
      outputDiv = document.getElementById("altair-viz-2fa964c99e804e6fae4ee25413f81b01");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.15.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.15.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-3465235ed13d4c726d91906b3e5060da"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"field": "fold", "type": "nominal"}, "tooltip": [{"field": "epoch", "type": "quantitative"}, {"field": "accuracy", "format": ",.2f", "type": "quantitative"}], "x": {"field": "epoch", "type": "quantitative"}, "y": {"field": "accuracy", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.15.1.json", "datasets": {"data-3465235ed13d4c726d91906b3e5060da": [{"epoch": 1, "loss": 0.49388861656188965, "accuracy": 0.7890405058860779, "fold": "training"}, {"epoch": 2, "loss": 0.31007856130599976, "accuracy": 0.8901451230049133, "fold": "training"}, {"epoch": 3, "loss": 0.24617862701416016, "accuracy": 0.9142733216285706, "fold": "training"}, {"epoch": 4, "loss": 0.20660200715065002, "accuracy": 0.9266189932823181, "fold": "training"}, {"epoch": 5, "loss": 0.1791810542345047, "accuracy": 0.937968373298645, "fold": "training"}, {"epoch": 6, "loss": 0.15750417113304138, "accuracy": 0.9456790089607239, "fold": "training"}, {"epoch": 7, "loss": 0.14125186204910278, "accuracy": 0.9521767497062683, "fold": "training"}, {"epoch": 8, "loss": 0.1277123987674713, "accuracy": 0.9562053084373474, "fold": "training"}, {"epoch": 9, "loss": 0.1135692298412323, "accuracy": 0.9633095264434814, "fold": "training"}, {"epoch": 10, "loss": 0.1008852943778038, "accuracy": 0.9675113558769226, "fold": "training"}, {"epoch": 11, "loss": 0.08707012236118317, "accuracy": 0.9730128049850464, "fold": "training"}, {"epoch": 12, "loss": 0.08052635192871094, "accuracy": 0.9741823673248291, "fold": "training"}, {"epoch": 13, "loss": 0.07354652136564255, "accuracy": 0.9761316776275635, "fold": "training"}, {"epoch": 14, "loss": 0.0639297291636467, "accuracy": 0.9806367754936218, "fold": "training"}, {"epoch": 15, "loss": 0.05434611067175865, "accuracy": 0.9846653938293457, "fold": "training"}, {"epoch": 16, "loss": 0.04941670596599579, "accuracy": 0.9867013096809387, "fold": "training"}, {"epoch": 17, "loss": 0.04813485965132713, "accuracy": 0.986268162727356, "fold": "training"}, {"epoch": 18, "loss": 0.03732893615961075, "accuracy": 0.9902533888816833, "fold": "training"}, {"epoch": 19, "loss": 0.031048282980918884, "accuracy": 0.9925925731658936, "fold": "training"}, {"epoch": 20, "loss": 0.032271187752485275, "accuracy": 0.9926359057426453, "fold": "training"}, {"epoch": 1, "loss": 0.3717499077320099, "accuracy": 0.8579999804496765, "fold": "validation"}, {"epoch": 2, "loss": 0.30001088976860046, "accuracy": 0.8820000290870667, "fold": "validation"}, {"epoch": 3, "loss": 0.2779347002506256, "accuracy": 0.8899999856948853, "fold": "validation"}, {"epoch": 4, "loss": 0.30474793910980225, "accuracy": 0.8840000033378601, "fold": "validation"}, {"epoch": 5, "loss": 0.30938199162483215, "accuracy": 0.8845000267028809, "fold": "validation"}, {"epoch": 6, "loss": 0.3264929950237274, "accuracy": 0.8769999742507935, "fold": "validation"}, {"epoch": 7, "loss": 0.2999842166900635, "accuracy": 0.8830000162124634, "fold": "validation"}, {"epoch": 8, "loss": 0.3129108250141144, "accuracy": 0.887499988079071, "fold": "validation"}, {"epoch": 9, "loss": 0.32250848412513733, "accuracy": 0.8849999904632568, "fold": "validation"}, {"epoch": 10, "loss": 0.32675623893737793, "accuracy": 0.8834999799728394, "fold": "validation"}, {"epoch": 11, "loss": 0.34635430574417114, "accuracy": 0.8845000267028809, "fold": "validation"}, {"epoch": 12, "loss": 0.36762702465057373, "accuracy": 0.8755000233650208, "fold": "validation"}, {"epoch": 13, "loss": 0.37704676389694214, "accuracy": 0.8765000104904175, "fold": "validation"}, {"epoch": 14, "loss": 0.4272248148918152, "accuracy": 0.8769999742507935, "fold": "validation"}, {"epoch": 15, "loss": 0.47771960496902466, "accuracy": 0.8669999837875366, "fold": "validation"}, {"epoch": 16, "loss": 0.47194263339042664, "accuracy": 0.8744999766349792, "fold": "validation"}, {"epoch": 17, "loss": 0.46029171347618103, "accuracy": 0.8744999766349792, "fold": "validation"}, {"epoch": 18, "loss": 0.6295106410980225, "accuracy": 0.8510000109672546, "fold": "validation"}, {"epoch": 19, "loss": 0.4740228056907654, "accuracy": 0.878000020980835, "fold": "validation"}, {"epoch": 20, "loss": 0.504989743232727, "accuracy": 0.8759999871253967, "fold": "validation"}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>To compute the test accuracy, we rerun the entire sequence above, replacing the last line with</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_1h</span><span class="p">[</span><span class="n">mask</span><span class="p">,:],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test_1h</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0286 - accuracy: 0.9936 - val_loss: 0.5592 - val_accuracy: 0.8629 - 465ms/epoch - 10ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 2/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0268 - accuracy: 0.9935 - val_loss: 0.5882 - val_accuracy: 0.8615 - 368ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 3/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0220 - accuracy: 0.9955 - val_loss: 0.5976 - val_accuracy: 0.8627 - 371ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 4/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0236 - accuracy: 0.9941 - val_loss: 0.6095 - val_accuracy: 0.8615 - 372ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 5/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0188 - accuracy: 0.9953 - val_loss: 0.6223 - val_accuracy: 0.8612 - 366ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 6/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0204 - accuracy: 0.9953 - val_loss: 0.6381 - val_accuracy: 0.8602 - 371ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 7/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0183 - accuracy: 0.9960 - val_loss: 0.6389 - val_accuracy: 0.8616 - 367ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 8/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0057 - accuracy: 0.9998 - val_loss: 0.7101 - val_accuracy: 0.8595 - 372ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 9/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0175 - accuracy: 0.9960 - val_loss: 0.7006 - val_accuracy: 0.8613 - 373ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 10/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0189 - accuracy: 0.9956 - val_loss: 0.6976 - val_accuracy: 0.8611 - 371ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 11/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0149 - accuracy: 0.9966 - val_loss: 0.7056 - val_accuracy: 0.8602 - 368ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 12/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0034 - accuracy: 0.9998 - val_loss: 0.7337 - val_accuracy: 0.8612 - 386ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 13/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0130 - accuracy: 0.9966 - val_loss: 0.7513 - val_accuracy: 0.8618 - 372ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 14/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0146 - accuracy: 0.9962 - val_loss: 0.7728 - val_accuracy: 0.8589 - 372ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 15/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0022 - accuracy: 1.0000 - val_loss: 0.7874 - val_accuracy: 0.8600 - 369ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 16/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0133 - accuracy: 0.9971 - val_loss: 0.7988 - val_accuracy: 0.8601 - 373ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 17/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0018 - accuracy: 1.0000 - val_loss: 0.8907 - val_accuracy: 0.8538 - 376ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 18/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0114 - accuracy: 0.9969 - val_loss: 0.8301 - val_accuracy: 0.8594 - 373ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 19/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0198 - accuracy: 0.9957 - val_loss: 0.8410 - val_accuracy: 0.8576 - 375ms/epoch - 8ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 20/20
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46/46 - 0s - loss: 0.0014 - accuracy: 1.0000 - val_loss: 0.8551 - val_accuracy: 0.8600 - 368ms/epoch - 8ms/step
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./islr/labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="lab_10.9.3_convolutional_neural_networks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 10.9.3: Convolutional Neural Networks</p>
      </div>
    </a>
    <a class="right-next"
       href="lab_10.9.6_recurrent_neural_networks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 10.9.6: Recurrent Neural Networks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution">Attribution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-spare-binary-matrices">Using spare binary matrices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-lasso-logistic-regression">Fit Lasso Logistic Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-a-two-layer-feedforward-network">Build a two-layer feedforward network</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Daniel Kapitan
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>