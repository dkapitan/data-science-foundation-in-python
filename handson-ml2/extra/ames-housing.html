
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ames Housing case - examples of possible solutions &#8212; Data Science Foundation Curriculum</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://jads-nl.github.io/data-science-foundation-curriculum/handson-ml2/extra/ames-housing.html" />
    <link rel="shortcut icon" href="../../_static/favicon-32x32.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Pima Indians Diabetes" href="pima-indians-diabetes.html" />
    <link rel="prev" title="Pandas profiling" href="pandas-profiling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/jads-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science Foundation Curriculum</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Why this JupyterBook?
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Statistical Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../islr/introduction.html">
   Introduction to ISLRv2
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../islr/labs.html">
   Labs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_02.3_introduction.html">
     Lab 2.3: Introduction to Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_03.6_linear_regression.html">
     Lab 3.6: Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_04.7_classification_methods.html">
     Lab 4.7: Classification Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_05.3_cross_validation_and_the_bootstrap.html">
     Lab 5.3: Cross-Validation and the Bootstrap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_06.5.1_subset_selection_methods.html">
     Lab 6.5.1: Subset Selection Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_06.5.2_ridge_regression_and_the_lasso.html">
     Lab 6.5.2: Ridge Regression and the Lasso
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_06.5.3_pcr_and_pls_regression.html">
     Lab 6.5.3: PCR and PLS Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_07.8_non_linear_modelling.html">
     Lab 7.8: Non-linear Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_08.3_decision_trees.html">
     Lab 8.3: Decision Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_09.6_support_vector_machines.html">
     Lab 9.6: Support Vector Machines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_10.9.2_multilayer_network_on_mnist_digit_data.html">
     Lab 10.9.2: A Multilayer Network on the MNIST Digit Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_10.9.3_convolutional_neural_networks.html">
     Lab 10.9.3: Convolutional Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_10.9.5_imdb_document_classification.html">
     Lab 10.9.5: IMDb Document Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../islr/labs/lab_12.5_unsupervised_learning.html">
     Lab 12.5: Unsupervised Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../islr/exercises.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter2/index.html">
     Chapter 2
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise1.html">
       Exercise 2.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise2.html">
       Exercise 2.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise3.html">
       Exercise 2.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise4.html">
       Exercise 2.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise5.html">
       Exercise 2.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise6.html">
       Exercise 2.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise7.html">
       Exercise 2.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise8.html">
       Exercise 2.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise9.html">
       Exercise 2.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter2/exercise10.html">
       Exercise 2.10
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter3/index.html">
     Chapter 3
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise1.html">
       Exercise 3.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise2.html">
       Exercise 3.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise3.html">
       Exercise 3.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise4.html">
       Exercise 3.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise5.html">
       Exercise 3.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise6.html">
       Exercise 3.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise7.html">
       Exercise 3.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise8.html">
       Exercise 3.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise9.html">
       Exercise 3.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise10.html">
       Exercise 3.10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise11.html">
       Exercise 3.11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise12.html">
       Exercise 3.12
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise13.html">
       Exercise 3.13
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise14.html">
       Exercise 3.14
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter3/exercise15.html">
       Exercise 3.15
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter4/index.html">
     Chapter 4
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise1.html">
       Exercise 4.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise2.html">
       Exercise 4.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise3.html">
       Exercise 4.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise4.html">
       Exercise 4.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise5.html">
       Exercise 4.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise6.html">
       Exercise 4.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise7.html">
       Exercise 4.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise8.html">
       Exercise 4.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise9.html">
       Exercise 4.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise10.html">
       Exercise 10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise11.html">
       Exercise 11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise12.html">
       Exercise 12
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise13.html">
       Exercise 4.13
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise14.html">
       Exercise 4.11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise15.html">
       Exercise 4.12
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter4/exercise16.html">
       Exercise 4.16
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter5/index.html">
     Chapter 5
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise1.html">
       Exercise 5.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise2.html">
       Exercise 5.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise3.html">
       Problem 5.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise4.html">
       Exercise 5.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise5.html">
       Exercise 5.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise6.html">
       Exercise 5.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise7.html">
       Exercise 5.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise8.html">
       Exercise 5.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter5/exercise9.html">
       Exercise 5.9
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter6/index.html">
     Chapter 6
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise1.html">
       Exercise 6.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise2.html">
       Exercise 6.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise3.html">
       Exercise 6.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise4.html">
       Exercise 6.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise5.html">
       Exercise 6.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise6.html">
       Exercise 6.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise7.html">
       Exercise 6.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise8.html">
       Exercise 6.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise9.html">
       Exercise 6.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise10.html">
       Exercise 6.10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter6/exercise11.html">
       Exercise 6.11
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter7/index.html">
     Chapter 7
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise1.html">
       Exercise 7.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise2.html">
       Exercise 7.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise3.html">
       Exercise 7.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise4.html">
       Exercise 7.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise5.html">
       Exercise 7.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise6.html">
       Exercise 7.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise7.html">
       Exercise 7.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise8.html">
       Exercise 7.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise9.html">
       Exercise 7.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise10.html">
       Exercise 7.10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise11.html">
       Exercise 7.11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter7/exercise12.html">
       Exercise 7.12
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter8/index.html">
     Chapter 8
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise1.html">
       Exercise 8.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise2.html">
       Exercise 8.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise3.html">
       Exercise 8.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise4.html">
       Exercise 8.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise5.html">
       Exercise 8.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise6.html">
       Exercise 8.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise7.html">
       Exercise 8.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise8.html">
       Exercise 8.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise9.html">
       Exercise 8.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise10.html">
       Exercise 8.10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise11.html">
       Exercise 8.11
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter8/exercise12.html">
       Exercise 8.12
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter9/index.html">
     Chapter 9
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise1.html">
       Exercise 9.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise2.html">
       Exercise 9.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise3.html">
       Exercise 9.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise4.html">
       Exercise 9.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise5.html">
       Exercise 9.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise6.html">
       Exercise 9.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise7.html">
       Exercise 9.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter9/exercise8.html">
       Exercise 9.8
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../islr/exercises/chapter12/index.html">
     Chapter 12
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise1.html">
       Exercise 12.1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise2.html">
       Exercise 12.2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise3.html">
       Exercise 12.3
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise4.html">
       Exercise 12.4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise5.html">
       Exercise 12.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise6.html">
       Exercise 12.6
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise7.html">
       Exercise 12.7
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise8.html">
       Exercise 10.8
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise9.html">
       Exercise 12.9
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise10.html">
       Exercise 12.10
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../islr/exercises/chapter12/exercise11.html">
       Exercise 12.11
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Hands-on Machine Learning in Python
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../introduction.html">
   Hands-on Machine Learning with Aurélien Géron
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/01_the_machine_learning_landscape.html">
     Chapter 1 – The Machine Learning landscape
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/02_end_to_end_machine_learning_project.html">
     Chapter 2 – End-to-end Machine Learning project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/03_classification.html">
     Chapter 3 – Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/04_training_linear_models.html">
     Chapter 4 – Training Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/05_support_vector_machines.html">
     Chapter 5 – Support Vector Machines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/06_decision_trees.html">
     Chapter 6 – Decision Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/07_ensemble_learning_and_random_forests.html">
     Chapter 7 – Ensemble Learning and Random Forests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/08_dimensionality_reduction.html">
     Chapter 8 – Dimensionality Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/09_unsupervised_learning.html">
     Chapter 9 – Unsupervised Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/10_neural_nets_with_keras.html">
     Chapter 10 – Introduction to Artificial Neural Networks with Keras
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/11_training_deep_neural_networks.html">
     Chapter 11 – Training Deep Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/12_custom_models_and_training_with_tensorflow.html">
     Chapter 12 – Custom Models and Training with TensorFlow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/13_loading_and_preprocessing_data.html">
     Chapter 13 – Loading and Preprocessing Data with TensorFlow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/14_deep_computer_vision_with_cnns.html">
     Chapter 14 – Deep Computer Vision Using Convolutional Neural Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/15_processing_sequences_using_rnns_and_cnns.html">
     Chapter 15 – Processing Sequences Using RNNs and CNNs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/16_nlp_with_rnns_and_attention.html">
     Chapter 16 – Natural Language Processing with RNNs and Attention**
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/17_autoencoders_and_gans.html">
     Chapter 17 – Autoencoders and GANs**
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/18_reinforcement_learning.html">
     Chapter 18 – Reinforcement Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/19_training_and_deploying_at_scale.html">
     Chapter 19 – Training and Deploying TensorFlow Models at Scale
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../extra.html">
   Miscellaneous tips &amp; tricks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="overfitting.html">
     Overfitting vs. underfitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="effective-python-and-idiomatic-pandas.html">
     Effective Python and idiomatic pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/math_linear_algebra.html">
     Math primer - Linear Algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/math_differential_calculus.html">
     Math primer - Differential Calculus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/extra_autodiff.html">
     Implementation of autodiff techniques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../original/extra_gradient_descent_comparison.html">
     Comparison of Batch, Mini-Batch and Stochastic Gradient Descent
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../projects.html">
   Discover projects
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pandas-profiling.html">
     Pandas profiling
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Ames Housing case - examples of possible solutions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pima-indians-diabetes.html">
     Pima Indians Diabetes
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data visualization with Altair
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../visualization/introduction-to-interactive-data-visualization.html">
   Introduction to data visualization with Python
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../visualization/altair_get_started.html">
   Getting Started with Altair
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_introduction.html">
     Introduction to Altair
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_marks_encoding.html">
     Data Types, Graphical Marks, and Visual Encoding Channels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_data_transformation.html">
     Data Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_scales_axes_legends.html">
     Scales, Axes, and Legends
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_view_composition.html">
     Multi-View Composition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_interaction.html">
     Interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_cartographic.html">
     Cartographic Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../visualization/altair_debugging.html">
     Altair Debugging Guide
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Interpretable Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../iml/introduction.html">
   Introduction to IML
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../iml/plot_partial_dependence.html">
     Partial Dependence and Individual Conditional Expectation Plots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../iml/plot_permutation_importance.html">
     Permutation Importance vs Random Forest Feature Importance (MDI)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../iml/plot_permutation_importance_multicollinear.html">
     Permutation Importance with Multicollinear or Correlated Features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../iml/interpreting-machine-learning-models.html">
     IML with Pima Indians and the Titanic datasets
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Principles of time-series forecasting
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpp/introduction.html">
   Introduction to FPP3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpp/examples-time-series-forecasting-with-python.html">
   Examples of time-series forecasting with Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Natural language processing with spaCy
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../nlp/introduction.html">
   Introduction to NLP with spaCy
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../nlp/dutch-restaurant-reviews.html">
   Dutch restaurant reviews
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../nlp/nlp-dutch-restaurant-reviews.html">
     Analyzing Dutch restaurant reviews
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../nlp/prepare-restoreviews-dataset.html">
     Fetch and prepare reviews
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../nlp/nlp-pipeline-example.html">
     Predict detractors from reviews
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../nlp/language-detection-with-character-quadgrams.html">
     Extra: language detection with character quadgrams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../nlp/nlp-model-sizes.html">
     Extra: plot of transformer model sizes
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/handson-ml2/extra/ames-housing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jads-nl/data-science-foundation-curriculum"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jads-nl/data-science-foundation-curriculum/issues/new?title=Issue%20on%20page%20%2Fhandson-ml2/extra/ames-housing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jads-nl/data-science-foundation-curriculum/main?urlpath=tree/data_science_foundation_curriculum/handson-ml2/extra/ames-housing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/jads-nl/data-science-foundation-curriculum/blob/main/data_science_foundation_curriculum/handson-ml2/extra/ames-housing.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objective">
   Objective
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-understanding">
   Data understanding
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploratory-data-analysis-eda">
     Exploratory data analysis (EDA)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimizing-memory-usage">
     Optimizing memory usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-columns-by-dtype-with-df-select-dtypes">
     Selecting columns by
     <code class="docutils literal notranslate">
      <span class="pre">
       dtype
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       df.select_dtypes
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#making-a-pipeline">
     Making a pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models">
   Linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn.linear_model.LinearRegression
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-detailed-look-at-linear-model">
     More detailed look at linear model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise">
       Exercise
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#answer">
       Answer
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-lassocv">
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn.linear_model.LassoCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#faq-does-it-matter-whether-y-is-normally-distributed">
     FAQ: does it matter whether Y is normally distributed?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#further-reading">
       Further reading
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-kbest-feature-selection">
     Adding
     <code class="docutils literal notranslate">
      <span class="pre">
       KBest
      </span>
     </code>
     feature selection
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-linear-models">
   Non-linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-forest">
     Random Forest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost">
     XGBoost
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models-revisted">
   Linear models revisted
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pca-and-linear-model">
     PCA and linear model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#does-it-help-to-use-separate-linear-models">
     Does it help to use separate linear models?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concluding-remarks">
   Concluding remarks
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ames Housing case - examples of possible solutions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#objective">
   Objective
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-understanding">
   Data understanding
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploratory-data-analysis-eda">
     Exploratory data analysis (EDA)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimizing-memory-usage">
     Optimizing memory usage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-columns-by-dtype-with-df-select-dtypes">
     Selecting columns by
     <code class="docutils literal notranslate">
      <span class="pre">
       dtype
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       df.select_dtypes
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#making-a-pipeline">
     Making a pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models">
   Linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn.linear_model.LinearRegression
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#more-detailed-look-at-linear-model">
     More detailed look at linear model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise">
       Exercise
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#answer">
       Answer
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-lassocv">
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn.linear_model.LassoCV
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#faq-does-it-matter-whether-y-is-normally-distributed">
     FAQ: does it matter whether Y is normally distributed?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#further-reading">
       Further reading
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-kbest-feature-selection">
     Adding
     <code class="docutils literal notranslate">
      <span class="pre">
       KBest
      </span>
     </code>
     feature selection
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-linear-models">
   Non-linear models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#random-forest">
     Random Forest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xgboost">
     XGBoost
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-models-revisted">
   Linear models revisted
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pca-and-linear-model">
     PCA and linear model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#does-it-help-to-use-separate-linear-models">
     Does it help to use separate linear models?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concluding-remarks">
   Concluding remarks
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/jads-nl/discover-projects-solutions/blob/main/ames-housing/possible_solutions_ames_housing.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we want to use sklearn &gt;= 0.23 for visualizing pipelines</span>
<span class="c1"># !pip install -U scikit-learn</span>
</pre></div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="ames-housing-case-examples-of-possible-solutions">
<h1>Ames Housing case - examples of possible solutions<a class="headerlink" href="#ames-housing-case-examples-of-possible-solutions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>There are many ways to skin a cat, so there isn’t one ‘silver bullit’ solution to the Ames Housing case. This notebook provides possible solutions with the following in mind:</p>
<ul class="simple">
<li><p>Solutions how to do the various steps of the data mining process in clean and compact code, using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> as much as possible</p></li>
<li><p>KISS principle: see how we can build the best prediction with the least amount of variables</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">estimator_html_repr</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span><span class="p">,</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span><span class="p">,</span> <span class="n">Pipeline</span> 
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="c1"># check version</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using scikit-learn version </span><span class="si">{</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># setting to visualize pipelines</span>
<span class="c1"># see https://towardsdatascience.com/are-you-using-pipeline-in-scikit-learn-ac4cd85cb27f</span>
<span class="n">sklearn</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;diagram&#39;</span><span class="p">)</span>

<span class="c1"># figsize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="c1"># seaborn theme</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>

<span class="c1"># dataset</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/jads-nl/discover-projects/blob/main/ames-housing/AmesHousing.csv?raw=true&#39;</span>

<span class="c1"># leaderboard to compare our results</span>
<span class="n">LEADERBOARD</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/jads-nl/discover-projects/blob/main/ames-housing/house-prices-advanced-regression-techniques-publicleaderboard.csv?raw=true&#39;</span>

<span class="c1"># fill-value for missings in categorical variables</span>
<span class="n">MISSING</span> <span class="o">=</span> <span class="s1">&#39;missing&#39;</span>
<span class="n">NONE</span> <span class="o">=</span> <span class="s1">&#39;not present&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>using scikit-learn version 0.23.2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-understanding">
<h2>Data understanding<a class="headerlink" href="#data-understanding" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exploratory-data-analysis-eda">
<h3>Exploratory data analysis (EDA)<a class="headerlink" href="#exploratory-data-analysis-eda" title="Permalink to this headline">¶</a></h3>
<p>For an elaborate EDA, please refer to <a class="reference external" href="https://www.kaggle.com/pmarcelino/comprehensive-data-exploration-with-python">Pedro Marcelino’s notebook on Kaggle</a>. We will cut the chase and just follow-up on the recommendations by the author of the dataset:</p>
<ul class="simple">
<li><p>Remove all homes with a living area (GR LIVE AREA) above 4000 square feet</p></li>
<li><p>NAs means ‘not presents’ for the categorical variables <code class="docutils literal notranslate"><span class="pre">Alley</span></code>, <code class="docutils literal notranslate"><span class="pre">Bsmt</span> <span class="pre">Qual</span></code>, <code class="docutils literal notranslate"><span class="pre">Bsmt</span> <span class="pre">Cond</span></code>, <code class="docutils literal notranslate"><span class="pre">BsmtFin</span> <span class="pre">Type</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">BsmtFin</span> <span class="pre">Type</span> <span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">Fireplace</span> <span class="pre">Qu</span></code>,
<code class="docutils literal notranslate"><span class="pre">Garage</span> <span class="pre">Type</span></code>, <code class="docutils literal notranslate"><span class="pre">Garage</span> <span class="pre">Finish</span></code>, <code class="docutils literal notranslate"><span class="pre">Garage</span> <span class="pre">Qual</span></code>, <code class="docutils literal notranslate"><span class="pre">GarageCond</span></code>, <code class="docutils literal notranslate"><span class="pre">Pool</span> <span class="pre">QC</span></code> <code class="docutils literal notranslate"><span class="pre">Fence</span></code>, <code class="docutils literal notranslate"><span class="pre">Garage</span> <span class="pre">Yr</span> <span class="pre">Blt</span></code> and <code class="docutils literal notranslate"><span class="pre">Misc</span> <span class="pre">Feature</span></code></p></li>
</ul>
<p>To get started we use <code class="docutils literal notranslate"><span class="pre">pandas.read_csv</span></code>. Note that you can directly fetch a file from internet (without having to download it locally). This makes it easy for sharing on online Jupyter environments like Colab.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2930 entries, 0 to 2929
Data columns (total 82 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   Order            2930 non-null   int64  
 1   PID              2930 non-null   int64  
 2   MS SubClass      2930 non-null   int64  
 3   MS Zoning        2930 non-null   object 
 4   Lot Frontage     2440 non-null   float64
 5   Lot Area         2930 non-null   int64  
 6   Street           2930 non-null   object 
 7   Alley            198 non-null    object 
 8   Lot Shape        2930 non-null   object 
 9   Land Contour     2930 non-null   object 
 10  Utilities        2930 non-null   object 
 11  Lot Config       2930 non-null   object 
 12  Land Slope       2930 non-null   object 
 13  Neighborhood     2930 non-null   object 
 14  Condition 1      2930 non-null   object 
 15  Condition 2      2930 non-null   object 
 16  Bldg Type        2930 non-null   object 
 17  House Style      2930 non-null   object 
 18  Overall Qual     2930 non-null   int64  
 19  Overall Cond     2930 non-null   int64  
 20  Year Built       2930 non-null   int64  
 21  Year Remod/Add   2930 non-null   int64  
 22  Roof Style       2930 non-null   object 
 23  Roof Matl        2930 non-null   object 
 24  Exterior 1st     2930 non-null   object 
 25  Exterior 2nd     2930 non-null   object 
 26  Mas Vnr Type     2907 non-null   object 
 27  Mas Vnr Area     2907 non-null   float64
 28  Exter Qual       2930 non-null   object 
 29  Exter Cond       2930 non-null   object 
 30  Foundation       2930 non-null   object 
 31  Bsmt Qual        2850 non-null   object 
 32  Bsmt Cond        2850 non-null   object 
 33  Bsmt Exposure    2847 non-null   object 
 34  BsmtFin Type 1   2850 non-null   object 
 35  BsmtFin SF 1     2929 non-null   float64
 36  BsmtFin Type 2   2849 non-null   object 
 37  BsmtFin SF 2     2929 non-null   float64
 38  Bsmt Unf SF      2929 non-null   float64
 39  Total Bsmt SF    2929 non-null   float64
 40  Heating          2930 non-null   object 
 41  Heating QC       2930 non-null   object 
 42  Central Air      2930 non-null   object 
 43  Electrical       2929 non-null   object 
 44  1st Flr SF       2930 non-null   int64  
 45  2nd Flr SF       2930 non-null   int64  
 46  Low Qual Fin SF  2930 non-null   int64  
 47  Gr Liv Area      2930 non-null   int64  
 48  Bsmt Full Bath   2928 non-null   float64
 49  Bsmt Half Bath   2928 non-null   float64
 50  Full Bath        2930 non-null   int64  
 51  Half Bath        2930 non-null   int64  
 52  Bedroom AbvGr    2930 non-null   int64  
 53  Kitchen AbvGr    2930 non-null   int64  
 54  Kitchen Qual     2930 non-null   object 
 55  TotRms AbvGrd    2930 non-null   int64  
 56  Functional       2930 non-null   object 
 57  Fireplaces       2930 non-null   int64  
 58  Fireplace Qu     1508 non-null   object 
 59  Garage Type      2773 non-null   object 
 60  Garage Yr Blt    2771 non-null   float64
 61  Garage Finish    2771 non-null   object 
 62  Garage Cars      2929 non-null   float64
 63  Garage Area      2929 non-null   float64
 64  Garage Qual      2771 non-null   object 
 65  Garage Cond      2771 non-null   object 
 66  Paved Drive      2930 non-null   object 
 67  Wood Deck SF     2930 non-null   int64  
 68  Open Porch SF    2930 non-null   int64  
 69  Enclosed Porch   2930 non-null   int64  
 70  3Ssn Porch       2930 non-null   int64  
 71  Screen Porch     2930 non-null   int64  
 72  Pool Area        2930 non-null   int64  
 73  Pool QC          13 non-null     object 
 74  Fence            572 non-null    object 
 75  Misc Feature     106 non-null    object 
 76  Misc Val         2930 non-null   int64  
 77  Mo Sold          2930 non-null   int64  
 78  Yr Sold          2930 non-null   int64  
 79  Sale Type        2930 non-null   object 
 80  Sale Condition   2930 non-null   object 
 81  SalePrice        2930 non-null   int64  
dtypes: float64(11), int64(28), object(43)
memory usage: 1.8+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use fillna for all columns where na means none</span>
<span class="n">cols_na_means_none</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Alley&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Bsmt Qual&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Bsmt Cond&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BsmtFin Type 1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BsmtFin Type 2&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Fireplace Qu&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Garage Type&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Garage Finish&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Garage Qual&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Garage Cond&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Pool QC&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Fence&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Misc Feature&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols_na_means_none</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols_na_means_none</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">NONE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># see which columns have NAs, you could make this into a small utility function</span>
<span class="k">def</span> <span class="nf">na_per_columns</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates nulls per column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nulls</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nulls</span><span class="p">[</span><span class="n">nulls</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">cols_with_nulls</span> <span class="o">=</span> <span class="n">na_per_columns</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">cols_with_nulls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lot Frontage      490
Garage Yr Blt     159
Bsmt Exposure      83
Mas Vnr Area       23
Mas Vnr Type       23
Bsmt Half Bath      2
Bsmt Full Bath      2
Garage Area         1
Garage Cars         1
Electrical          1
Total Bsmt SF       1
Bsmt Unf SF         1
BsmtFin SF 2        1
BsmtFin SF 1        1
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check outliers Gr Liv Area &gt; 4000</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gr Liv Area&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_9_0.png" src="../../_images/ames-housing_9_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check Sale Condition</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normal     2413
Partial     245
Abnorml     190
Family       46
Alloca       24
AdjLand      12
Name: Sale Condition, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove outliers</span>
<span class="c1"># see https://pandas.pydata.org/docs/user_guide/indexing.html?highlight=boolean%20indexing#boolean-indexing</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gr Liv Area&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4000</span><span class="p">)]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2925, 82)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optimizing-memory-usage">
<h3>Optimizing memory usage<a class="headerlink" href="#optimizing-memory-usage" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">df.info()</span></code> to get a first view. In this case the dataset is not so large (1.8 MB). If anything gets beyond hundreds of MBs in memory, it helps to optimize, by using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html?highlight=to_numeric#pandas.to_numeric"><code class="docutils literal notranslate"><span class="pre">pd.to_numeric(downcast=...)</span></code></a> and converting categorical variables to <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html"><code class="docutils literal notranslate"><span class="pre">pd.categorical</span></code></a>. Doing so reduces the memory to 22% of the orginal (400 KB).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># objects to categorical</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># convert integers to smallest unsigned integer and floats to smallest</span>
<span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">)]:</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">old</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">downcast</span><span class="o">=</span><span class="n">new</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 2925 entries, 0 to 2929
Data columns (total 82 columns):
 #   Column           Non-Null Count  Dtype   
---  ------           --------------  -----   
 0   Order            2925 non-null   uint16  
 1   PID              2925 non-null   uint32  
 2   MS SubClass      2925 non-null   uint8   
 3   MS Zoning        2925 non-null   category
 4   Lot Frontage     2435 non-null   float32 
 5   Lot Area         2925 non-null   uint32  
 6   Street           2925 non-null   category
 7   Alley            2925 non-null   category
 8   Lot Shape        2925 non-null   category
 9   Land Contour     2925 non-null   category
 10  Utilities        2925 non-null   category
 11  Lot Config       2925 non-null   category
 12  Land Slope       2925 non-null   category
 13  Neighborhood     2925 non-null   category
 14  Condition 1      2925 non-null   category
 15  Condition 2      2925 non-null   category
 16  Bldg Type        2925 non-null   category
 17  House Style      2925 non-null   category
 18  Overall Qual     2925 non-null   uint8   
 19  Overall Cond     2925 non-null   uint8   
 20  Year Built       2925 non-null   uint16  
 21  Year Remod/Add   2925 non-null   uint16  
 22  Roof Style       2925 non-null   category
 23  Roof Matl        2925 non-null   category
 24  Exterior 1st     2925 non-null   category
 25  Exterior 2nd     2925 non-null   category
 26  Mas Vnr Type     2902 non-null   category
 27  Mas Vnr Area     2902 non-null   float32 
 28  Exter Qual       2925 non-null   category
 29  Exter Cond       2925 non-null   category
 30  Foundation       2925 non-null   category
 31  Bsmt Qual        2925 non-null   category
 32  Bsmt Cond        2925 non-null   category
 33  Bsmt Exposure    2842 non-null   category
 34  BsmtFin Type 1   2925 non-null   category
 35  BsmtFin SF 1     2924 non-null   float32 
 36  BsmtFin Type 2   2925 non-null   category
 37  BsmtFin SF 2     2924 non-null   float32 
 38  Bsmt Unf SF      2924 non-null   float32 
 39  Total Bsmt SF    2924 non-null   float32 
 40  Heating          2925 non-null   category
 41  Heating QC       2925 non-null   category
 42  Central Air      2925 non-null   category
 43  Electrical       2924 non-null   category
 44  1st Flr SF       2925 non-null   uint16  
 45  2nd Flr SF       2925 non-null   uint16  
 46  Low Qual Fin SF  2925 non-null   uint16  
 47  Gr Liv Area      2925 non-null   uint16  
 48  Bsmt Full Bath   2923 non-null   float32 
 49  Bsmt Half Bath   2923 non-null   float32 
 50  Full Bath        2925 non-null   uint8   
 51  Half Bath        2925 non-null   uint8   
 52  Bedroom AbvGr    2925 non-null   uint8   
 53  Kitchen AbvGr    2925 non-null   uint8   
 54  Kitchen Qual     2925 non-null   category
 55  TotRms AbvGrd    2925 non-null   uint8   
 56  Functional       2925 non-null   category
 57  Fireplaces       2925 non-null   uint8   
 58  Fireplace Qu     2925 non-null   category
 59  Garage Type      2925 non-null   category
 60  Garage Yr Blt    2766 non-null   float32 
 61  Garage Finish    2925 non-null   category
 62  Garage Cars      2924 non-null   float32 
 63  Garage Area      2924 non-null   float32 
 64  Garage Qual      2925 non-null   category
 65  Garage Cond      2925 non-null   category
 66  Paved Drive      2925 non-null   category
 67  Wood Deck SF     2925 non-null   uint16  
 68  Open Porch SF    2925 non-null   uint16  
 69  Enclosed Porch   2925 non-null   uint16  
 70  3Ssn Porch       2925 non-null   uint16  
 71  Screen Porch     2925 non-null   uint16  
 72  Pool Area        2925 non-null   uint16  
 73  Pool QC          2925 non-null   category
 74  Fence            2925 non-null   category
 75  Misc Feature     2925 non-null   category
 76  Misc Val         2925 non-null   uint16  
 77  Mo Sold          2925 non-null   uint8   
 78  Yr Sold          2925 non-null   uint16  
 79  Sale Type        2925 non-null   category
 80  Sale Condition   2925 non-null   category
 81  SalePrice        2925 non-null   uint32  
dtypes: category(43), float32(11), uint16(15), uint32(3), uint8(10)
memory usage: 431.9 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># no data snooping</span>
<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate which columns have large percentage missing values, say 20%</span>
<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols_with_nulls</span><span class="p">[</span><span class="n">cols_with_nulls</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">.</span><span class="n">index</span>
<span class="n">cols_with_nulls</span><span class="p">[</span><span class="n">cols_to_drop</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series([], dtype: int64)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<p>So we are going to:</p>
<ul class="simple">
<li><p>Create different regression models for the logarithm of the <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code></p></li>
<li><p>Drop columns with more than 20% missing values</p></li>
<li><p>Impute missing values using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html#sklearn.impute.SimpleImputer"><code class="docutils literal notranslate"><span class="pre">sklearn.impute.SimpleImputer</span></code></a></p>
<ul>
<li><p>‘median’ for numerical features</p></li>
<li><p>fill with ‘missing’ for categorical features</p></li>
</ul>
</li>
<li><p>use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder"><code class="docutils literal notranslate"><span class="pre">OneHotEncoding</span></code></a> for all categorical variables</p></li>
<li><p>use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html#sklearn.preprocessing.StandardScaler"><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></a> on numerical variables just to be sure.</p></li>
</ul>
<p>We are going to use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html"><code class="docutils literal notranslate"><span class="pre">sklearn.pipeline.Pipeline</span></code></a> for our whole workflow. It is good practice to structure your ML project into separate pipelines for each model. This also allows for stacking models, as is explained in <a class="reference external" href="https://scikit-learn.org/stable/auto_examples/ensemble/plot_stack_predictors.html#sphx-glr-auto-examples-ensemble-plot-stack-predictors-py">this example by Guillaume Lemaitre in the sklearn documentation</a>.</p>
<div class="section" id="selecting-columns-by-dtype-with-df-select-dtypes">
<h3>Selecting columns by <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.scalars.html"><code class="docutils literal notranslate"><span class="pre">dtype</span></code></a> with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html?highlight=select_dtype"><code class="docutils literal notranslate"><span class="pre">df.select_dtypes</span></code></a><a class="headerlink" href="#selecting-columns-by-dtype-with-df-select-dtypes" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare X and y, using log(SalePrice) throughout</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>

<span class="c1"># same for test set</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols_to_drop</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>

<span class="c1"># read https://numpy.org/doc/stable/reference/arrays.scalars.html</span>
<span class="c1"># for understanding NumPy dtype hierarchy</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="making-a-pipeline">
<h3>Making a pipeline<a class="headerlink" href="#making-a-pipeline" title="Permalink to this headline">¶</a></h3>
<p>If you want to read more about pipelines, see <a class="reference external" href="https://towardsdatascience.com/are-you-using-pipeline-in-scikit-learn-ac4cd85cb27f">this blogpost by Ankit Goel</a>.</p>
<p>If you have used <code class="docutils literal notranslate"><span class="pre">category</span></code> dtypes from the start, you can access the categories of each categorical column with <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.cat.html?highlight=cat#pandas.Series.cat"><code class="docutils literal notranslate"><span class="pre">pd.Series.cat</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># need to explicitly define categories for pipeline</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">:</span>
    <span class="c1"># need to add category for missings, otherwise error with OneHotEncoding</span>
    <span class="n">X</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="n">MISSING</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">]</span>

<span class="c1"># combine all preprocessing for cat_cols in one pipeline</span>
<span class="n">preprocess_cat_cols</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span>
        <span class="n">missing_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">MISSING</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># same for num_cols</span>
<span class="n">preprocess_num_cols</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span>
        <span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span>
        <span class="p">),</span>
    <span class="n">StandardScaler</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># compose dataset with make_column_transformer</span>
<span class="n">prepare_linear</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">preprocess_num_cols</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span>
    <span class="p">(</span><span class="n">preprocess_cat_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">),</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="linear-models">
<h2>Linear models<a class="headerlink" href="#linear-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sklearn-linear-model-linearregression">
<h3><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression"><code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LinearRegression</span></code></a><a class="headerlink" href="#sklearn-linear-model-linearregression" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">prepare_linear</span><span class="p">,</span>
    <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="p">)</span>

<span class="n">ols_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">ols</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_cv_scores</span><span class="p">(</span><span class="n">cv_score</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make scatterplot from cross_validate.score object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cv_score</span><span class="p">[</span><span class="s1">&#39;train_neg_mean_squared_error&#39;</span><span class="p">]),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cv_score</span><span class="p">[</span><span class="s1">&#39;test_neg_mean_squared_error&#39;</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;train score&#39;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;validation score&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">plot_cv_scores</span><span class="p">(</span><span class="n">ols_scores</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_25_0.png" src="../../_images/ames-housing_25_0.png" />
</div>
</div>
<p>We can conclude from this that we need more work: a low RMSLE on the training set results in the highest RMSLE for the validation set (and vice versa). This means we are overfitting. The best model for now is in the bottom right corner, with the RMSLE around 0.08. Let’s check which estimator that is and do final scoring on test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_best_model</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return best (most conservative) model from cross_validate object.</span>
<span class="sd">    </span>
<span class="sd">    Uses np.argmax to find bottomright point == largest RMLSE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cv_scores</span><span class="p">[</span><span class="s1">&#39;train_neg_mean_squared_error&#39;</span><span class="p">]))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">cv_scores</span><span class="p">[</span><span class="s1">&#39;estimator&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
    <span class="n">rmsle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rmsle</span><span class="p">)</span>

<span class="n">ols_best_model</span><span class="p">,</span> <span class="n">ols_rmsle</span> <span class="o">=</span> <span class="n">get_best_model</span><span class="p">(</span><span class="n">ols_scores</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best OLS model:</span><span class="se">\n</span><span class="s2">  RMLSE test: </span><span class="si">{</span><span class="n">ols_rmsle</span><span class="si">:</span><span class="s2">0.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best OLS model:
  RMLSE test: 0.13798
</pre></div>
</div>
</div>
</div>
<p>Not bad: a simple regression model, with preparing the data just as the author instructed yields a RMSLE of around 0.13. Let’s see where that gets us on the leaderboard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">leaderboard</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">LEADERBOARD</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Score&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">leaderboard</span><span class="o">.</span><span class="n">Score</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">ols_rmsle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2331
</pre></div>
</div>
</div>
</div>
<p>Not bad: given there are more than 5,000 entries we are already in the 30%-percentile.</p>
</div>
<div class="section" id="more-detailed-look-at-linear-model">
<h3>More detailed look at linear model<a class="headerlink" href="#more-detailed-look-at-linear-model" title="Permalink to this headline">¶</a></h3>
<p>The author of the dataset states that it is easiest to build an estimator only for houses with <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span> <span class="pre">==</span> <span class="pre">'Normal'</span></code>. Let’s check what the distribution of house prices is per <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_original</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="n">df_original</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normal     2413
Partial     245
Abnorml     190
Family       46
Alloca       24
AdjLand      12
Name: Sale Condition, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_original</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_33_0.png" src="../../_images/ames-housing_33_0.png" />
</div>
</div>
<p>From this we conclude that the distribution of the <code class="docutils literal notranslate"><span class="pre">log(Sale</span> <span class="pre">Price)</span></code> is quite different depending on <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span></code>. This probably explains why our performance with a simple machine learning model does so well compared to the leaderboard. In another notebook we will build separate linear models for each <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span></code> and see how that performs.</p>
<div class="section" id="exercise">
<h4>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h4>
<p>Make change in section 2.1 in this notebook and re-run it to see the performance of the linear model only for <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span> <span class="pre">==</span> <span class="pre">&quot;Normal&quot;</span></code>. Hint: adjust the boolean index</p>
</div>
<div class="section" id="answer">
<h4>Answer<a class="headerlink" href="#answer" title="Permalink to this headline">¶</a></h4>
<p>RMSLE should be around 0.10, which sets the model around 130th place i.e. in the top 2.5% (although this is cheating of course).</p>
</div>
</div>
<div class="section" id="sklearn-linear-model-lassocv">
<h3><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LassoCV.html?highlight=lasso#sklearn.linear_model.LassoCV"><code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.LassoCV</span></code></a><a class="headerlink" href="#sklearn-linear-model-lassocv" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">LassoCV</span></code> so we can do cross-validation directly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">prepare_linear</span><span class="p">,</span>
    <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lasso</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="79a25e80-c2d4-4e20-8346-ca9f9430a68e" type="checkbox" ><label class="sk-toggleable__label" for="79a25e80-c2d4-4e20-8346-ca9f9430a68e">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('pipeline-1',
                                                  Pipeline(steps=[('simpleimputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('standardscaler',
                                                                   StandardScaler())]),
                                                  Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath...
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object'))])),
                ('lassocv', LassoCV(cv=10))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2742fcf8-09fa-4ffb-8d05-5014b56141ec" type="checkbox" ><label class="sk-toggleable__label" for="2742fcf8-09fa-4ffb-8d05-5014b56141ec">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'Garage Yr...
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object'))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a1bc7ec7-98f4-49e7-8463-e75fd10b8a17" type="checkbox" ><label class="sk-toggleable__label" for="a1bc7ec7-98f4-49e7-8463-e75fd10b8a17">pipeline-1</label><div class="sk-toggleable__content"><pre>Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'Garage Yr Blt', 'Gr Liv Area',
       'Half Bath', 'Kitchen AbvGr', 'Lot Area', 'Lot Frontage',
       'Low Qual Fin SF', 'MS SubClass', 'Mas Vnr Area', 'Misc Val', 'Mo Sold',
       'Open Porch SF', 'Order', 'Overall Cond', 'Overall Qual', 'PID',
       'Pool Area', 'Screen Porch', 'TotRms AbvGrd', 'Total Bsmt SF',
       'Wood Deck SF', 'Year Built', 'Year Remod/Add', 'Yr Sold'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="031c70e8-1e56-4546-965a-fa2656b21d83" type="checkbox" ><label class="sk-toggleable__label" for="031c70e8-1e56-4546-965a-fa2656b21d83">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6701f448-7cc9-4d97-a9d2-792eec9ac310" type="checkbox" ><label class="sk-toggleable__label" for="6701f448-7cc9-4d97-a9d2-792eec9ac310">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="39ed4364-b5bf-478c-b80f-4cab8261ca0e" type="checkbox" ><label class="sk-toggleable__label" for="39ed4364-b5bf-478c-b80f-4cab8261ca0e">pipeline-2</label><div class="sk-toggleable__content"><pre>Index(['Alley', 'Bldg Type', 'Bsmt Cond', 'Bsmt Exposure', 'Bsmt Qual',
       'BsmtFin Type 1', 'BsmtFin Type 2', 'Central Air', 'Condition 1',
       'Condition 2', 'Electrical', 'Exter Cond', 'Exter Qual', 'Exterior 1st',
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="24cae9dd-0eb3-4f00-8cae-308bbe2fe196" type="checkbox" ><label class="sk-toggleable__label" for="24cae9dd-0eb3-4f00-8cae-308bbe2fe196">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="927d7921-bff8-4def-825b-d2b5f3bc14c4" type="checkbox" ><label class="sk-toggleable__label" for="927d7921-bff8-4def-825b-d2b5f3bc14c4">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(categories=[Index(['Grvl', 'Pave', 'not present', 'missing'], dtype='object'),
                          Index(['1Fam', '2fmCon', 'Duplex', 'Twnhs', 'TwnhsE', 'missing'], dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtype='object'),
                          Index(['Av', 'Gd', 'Mn', 'No', 'missing'], dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtype...
                          Index(['1.5Fin', '1.5Unf', '1Story', '2.5Fin', '2.5Unf', '2Story', 'SFoyer',
       'SLvl', 'missing'],
      dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'missing'], dtype='object'),
                          Index(['Bnk', 'HLS', 'Low', 'Lvl', 'missing'], dtype='object'),
                          Index(['Gtl', 'Mod', 'Sev', 'missing'], dtype='object'),
                          Index(['Corner', 'CulDSac', 'FR2', 'FR3', 'Inside', 'missing'], dtype='object'), ...])</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="960519dc-689e-408a-a048-ff3f54d2138f" type="checkbox" ><label class="sk-toggleable__label" for="960519dc-689e-408a-a048-ff3f54d2138f">LassoCV</label><div class="sk-toggleable__content"><pre>LassoCV(cv=10)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get column names of OneHotEncoded categorical columns</span>
<span class="c1"># see https://stackoverflow.com/questions/54646709/sklearn-pipeline-get-feature-names-after-onehotencode-in-columntransformer</span>
<span class="n">onehot_features</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">[</span><span class="s1">&#39;columntransformer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;pipeline-2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;onehotencoder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso_coef_</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">num_cols</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">onehot_features</span><span class="p">]),</span>
     <span class="s1">&#39;coef_&#39;</span><span class="p">:</span> <span class="n">lasso</span><span class="p">[</span><span class="s1">&#39;lassocv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span>
     <span class="s1">&#39;coef_abs&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lasso</span><span class="p">[</span><span class="s1">&#39;lassocv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)})</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;coef_abs&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">lasso_coef_</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coef_</th>
      <th>coef_abs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>291</th>
      <td>Neighborhood_GrnHill</td>
      <td>0.194392</td>
      <td>0.194392</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Gr Liv Area</td>
      <td>0.124623</td>
      <td>0.124623</td>
    </tr>
    <tr>
      <th>287</th>
      <td>Neighborhood_Crawfor</td>
      <td>0.108902</td>
      <td>0.108902</td>
    </tr>
    <tr>
      <th>294</th>
      <td>Neighborhood_MeadowV</td>
      <td>-0.105096</td>
      <td>0.105096</td>
    </tr>
    <tr>
      <th>216</th>
      <td>Heating_Grav</td>
      <td>-0.090851</td>
      <td>0.090851</td>
    </tr>
    <tr>
      <th>335</th>
      <td>Sale Condition_Abnorml</td>
      <td>-0.082418</td>
      <td>0.082418</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Overall Qual</td>
      <td>0.074225</td>
      <td>0.074225</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Year Built</td>
      <td>0.070402</td>
      <td>0.070402</td>
    </tr>
    <tr>
      <th>306</th>
      <td>Neighborhood_StoneBr</td>
      <td>0.064134</td>
      <td>0.064134</td>
    </tr>
    <tr>
      <th>184</th>
      <td>Functional_Typ</td>
      <td>0.063078</td>
      <td>0.063078</td>
    </tr>
    <tr>
      <th>125</th>
      <td>Exterior 1st_BrkFace</td>
      <td>0.054223</td>
      <td>0.054223</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Overall Cond</td>
      <td>0.051323</td>
      <td>0.051323</td>
    </tr>
    <tr>
      <th>338</th>
      <td>Sale Condition_Family</td>
      <td>-0.050766</td>
      <td>0.050766</td>
    </tr>
    <tr>
      <th>178</th>
      <td>Functional_Maj2</td>
      <td>-0.049982</td>
      <td>0.049982</td>
    </tr>
    <tr>
      <th>305</th>
      <td>Neighborhood_Somerst</td>
      <td>0.047404</td>
      <td>0.047404</td>
    </tr>
    <tr>
      <th>267</th>
      <td>MS Zoning_RM</td>
      <td>-0.046451</td>
      <td>0.046451</td>
    </tr>
    <tr>
      <th>262</th>
      <td>MS Zoning_C (all)</td>
      <td>-0.045827</td>
      <td>0.045827</td>
    </tr>
    <tr>
      <th>300</th>
      <td>Neighborhood_NridgHt</td>
      <td>0.045645</td>
      <td>0.045645</td>
    </tr>
    <tr>
      <th>285</th>
      <td>Neighborhood_ClearCr</td>
      <td>0.043164</td>
      <td>0.043164</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Bsmt Exposure_Gd</td>
      <td>0.041212</td>
      <td>0.041212</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Condition 1_Norm</td>
      <td>0.037660</td>
      <td>0.037660</td>
    </tr>
    <tr>
      <th>284</th>
      <td>Neighborhood_BrkSide</td>
      <td>0.036992</td>
      <td>0.036992</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Total Bsmt SF</td>
      <td>0.036613</td>
      <td>0.036613</td>
    </tr>
    <tr>
      <th>235</th>
      <td>Kitchen Qual_Ex</td>
      <td>0.034890</td>
      <td>0.034890</td>
    </tr>
    <tr>
      <th>312</th>
      <td>Paved Drive_Y</td>
      <td>0.034649</td>
      <td>0.034649</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># all variables that are put to zero</span>
<span class="n">lasso_coef_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lasso_coef_</span><span class="o">.</span><span class="n">coef_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>296      Neighborhood_NAmes
283     Neighborhood_BrDale
274    Mas Vnr Type_missing
275       Misc Feature_Gar2
276       Misc Feature_Othr
               ...         
205      Garage Type_2Types
98         Condition 2_Norm
207     Garage Type_Basment
208     Garage Type_BuiltIn
359       Utilities_missing
Name: feature, Length: 230, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Out-of-the-box, <code class="docutils literal notranslate"><span class="pre">LassoCV</span></code> sets 225 (one-hot encoded) features to coefficient zero. As an intermediate conclusion, let’s check the RMSLE for the train and test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso_best_rmsle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Lasso RMSLE:</span>
<span class="s2">  train: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"></span>
<span class="s2">   test: </span><span class="si">{</span><span class="n">lasso_best_rmsle</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  alpha: </span><span class="si">{</span><span class="n">lasso</span><span class="p">[</span><span class="s1">&#39;lassocv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  rank on leaderboard: </span><span class="si">{</span><span class="n">leaderboard</span><span class="o">.</span><span class="n">Score</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">lasso_best_rmsle</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso RMSLE:
  train: 0.09555
   test: 0.13593791911157707
  alpha: 0.000325
  rank on leaderboard: 2157 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="faq-does-it-matter-whether-y-is-normally-distributed">
<h3>FAQ: does it matter whether Y is normally distributed?<a class="headerlink" href="#faq-does-it-matter-whether-y-is-normally-distributed" title="Permalink to this headline">¶</a></h3>
<p>The instructions fromt the Kaggle competition states</p>
<blockquote>
<div><p>The performance metric for your prediction model is the Root-Mean-Squared-Error (RMSE) between the logarithm of the predicted value and the logarithm of the observed sales price. (Taking logs means that errors in predicting expensive houses and cheap houses will affect the result equally.)</p>
</div></blockquote>
<p>So what would in fact happen if we just predicted <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> without taking the log? A linear model would perform a lot worse. Recall that a linear model will fit a function</p>
<div class="math notranslate nohighlight">
\[ y = \alpha + \beta X_i + \epsilon_i \]</div>
<p>If the spread in <span class="math notranslate nohighlight">\(y\)</span> is unbalanced, as is the case here with a lot of observations on the left-hand side, and a long-tail on the right-hand side, the coefficients <span class="math notranslate nohighlight">\(beta_n\)</span> will never be able to accurately model both sides of the distribution of <span class="math notranslate nohighlight">\(y\)</span>. This is remedied by taking the log and fitting a function</p>
<div class="math notranslate nohighlight">
\[ log(y) = \alpha + \beta X_i + \epsilon_i \]</div>
<p>You can think of a log-normal distribution as a ‘multiplicative normal distribution’: each 1-unit increase in <span class="math notranslate nohighlight">\(X\)</span> multiplies the expected value of <span class="math notranslate nohighlight">\(y\)</span> by <span class="math notranslate nohighlight">\(e^β\)</span>.</p>
<div class="section" id="further-reading">
<h4>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>article on <a class="reference external" href="https://github.com/jads-nl/discover-projects/blob/main/ames-housing/benoit2011logmodels.pdf">Linear Regression MOdels with Logarithmic Transformations</a> from Kenneth Benoit (LSE)</p></li>
<li><p>article on <a class="reference external" href="https://github.com/jads-nl/discover-projects/blob/main/ames-housing/limpert2001log-normal.pdf">Log-normal distributions across the sciences</a> by Limpert et al. (2001)</p></li>
</ul>
</div>
</div>
<div class="section" id="adding-kbest-feature-selection">
<h3>Adding <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_selection.SelectKBest.html#sklearn.feature_selection.SelectKBest"><code class="docutils literal notranslate"><span class="pre">KBest</span></code></a> feature selection<a class="headerlink" href="#adding-kbest-feature-selection" title="Permalink to this headline">¶</a></h3>
<p>Let’s see how the RMSLE decreases as we add more features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># warnings can be ignored, see</span>
<span class="c1"># https://github.com/scikit-learn/scikit-learn/issues/11395</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">f_regression</span>

<span class="n">lassos</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">lassos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">prepare_linear</span><span class="p">,</span>
        <span class="n">SelectKBest</span><span class="p">(</span>
            <span class="n">f_regression</span><span class="p">,</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">),</span>
        <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
/Users/dkapitan/.local/lib/python3.8/site-packages/sklearn/feature_selection/_univariate_selection.py:302: RuntimeWarning: invalid value encountered in true_divide
  corr /= X_norms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kbest_rmsle_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span> <span class="k">for</span> <span class="n">lasso</span> <span class="ow">in</span> <span class="n">lassos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">kbest_rmsle_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span> <span class="k">for</span> <span class="n">lasso</span> <span class="ow">in</span> <span class="n">lassos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">kbest_rmsle_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">kbest_rmsle_test</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">lassos</span><span class="o">.</span><span class="n">keys</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_46_0.png" src="../../_images/ames-housing_46_0.png" />
</div>
</div>
<p>So clearly the model improves as we add more KBest features. Let’s leave this for now and move on.</p>
</div>
</div>
<div class="section" id="non-linear-models">
<h2>Non-linear models<a class="headerlink" href="#non-linear-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="random-forest">
<h3>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocess_cat_cols_2</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span>
        <span class="n">missing_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">MISSING</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">preprocess_num_cols_2</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span>
        <span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span>
        <span class="p">),</span>
    <span class="n">StandardScaler</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">prepare_nonlinear</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">preprocess_num_cols_2</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span>
    <span class="p">(</span><span class="n">preprocess_cat_cols_2</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">),</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">prepare_nonlinear</span><span class="p">,</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                          <span class="n">min_weight_fraction_leaf</span><span class="o">=</span><span class="mf">0.005</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">rf_score</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">rf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plot_cv_scores</span><span class="p">(</span><span class="n">rf_score</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_51_0.png" src="../../_images/ames-housing_51_0.png" />
</div>
</div>
<p>Clearly we are overfitting the random forest, getting RMSLE of 0.09 for the training score vs a RMSLE between (0.11, 0.135) for the validation score. To do this properly, we need to perform hyperparameter-tuning with <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code>. But rather than doing that with random forest, we will do that with my personal favourite XGBboost, as it allows for more regularization.</p>
</div>
<div class="section" id="xgboost">
<h3>XGBoost<a class="headerlink" href="#xgboost" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="n">prepare_nonlinear</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;xgb&#39;</span><span class="p">,</span> <span class="n">XGBRegressor</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;xgb__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="c1"># only do small number for grid search to reduce compute</span>
    <span class="s1">&#39;xgb__objective&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">],</span>
    <span class="s1">&#39;xgb__eval_metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">],</span>
    <span class="s1">&#39;xgb__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.15</span><span class="p">],</span>
    <span class="s1">&#39;xgb__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;xgb__min_child_weight&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="s1">&#39;xgb__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">],</span>
    <span class="s1">&#39;xgb__reg_alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="s1">&#39;xgb__reg_lambda&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="s1">&#39;xgb__colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">],</span>
        <span class="p">}</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">xgb</span><span class="p">,</span> <span class="n">xgb_params</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 20.4 s, sys: 637 ms, total: 21 s
Wall time: 4min 40s
</pre></div>
</div>
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b01a6296-e59e-4674-9c50-ed2b81b327d3" type="checkbox" ><label class="sk-toggleable__label" for="b01a6296-e59e-4674-9c50-ed2b81b327d3">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(estimator=Pipeline(steps=[('pre',
                                        ColumnTransformer(transformers=[('pipeline-1',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(strategy='median')),
                                                                                         ('standardscaler',
                                                                                          StandardScaler())]),
                                                                         Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces',...
             n_jobs=-1,
             param_grid={'xgb__colsample_bytree': [0.3],
                         'xgb__eval_metric': ['rmse'], 'xgb__gamma': [0.1, 0.2],
                         'xgb__learning_rate': [0.05, 0.1, 0.15],
                         'xgb__max_depth': [3, 4, 5],
                         'xgb__min_child_weight': [2, 3, 4],
                         'xgb__n_estimators': [100],
                         'xgb__objective': ['reg:squarederror'],
                         'xgb__reg_alpha': [0.1, 0.5],
                         'xgb__reg_lambda': [0.1, 0.5]},
             scoring='neg_mean_squared_error')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1c02c0bc-b097-4afd-ad44-da0ced82ba86" type="checkbox" ><label class="sk-toggleable__label" for="1c02c0bc-b097-4afd-ad44-da0ced82ba86">pre: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'Garage Yr...
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object'))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9bf96b31-5042-4a7b-ab32-aee686b07ba3" type="checkbox" ><label class="sk-toggleable__label" for="9bf96b31-5042-4a7b-ab32-aee686b07ba3">pipeline-1</label><div class="sk-toggleable__content"><pre>Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'Garage Yr Blt', 'Gr Liv Area',
       'Half Bath', 'Kitchen AbvGr', 'Lot Area', 'Lot Frontage',
       'Low Qual Fin SF', 'MS SubClass', 'Mas Vnr Area', 'Misc Val', 'Mo Sold',
       'Open Porch SF', 'Order', 'Overall Cond', 'Overall Qual', 'PID',
       'Pool Area', 'Screen Porch', 'TotRms AbvGrd', 'Total Bsmt SF',
       'Wood Deck SF', 'Year Built', 'Year Remod/Add', 'Yr Sold'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="30b38a1e-7da2-4a5e-9dec-5c071cf2fd13" type="checkbox" ><label class="sk-toggleable__label" for="30b38a1e-7da2-4a5e-9dec-5c071cf2fd13">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6f4344ef-29b9-4aea-9509-04fb34cfbb08" type="checkbox" ><label class="sk-toggleable__label" for="6f4344ef-29b9-4aea-9509-04fb34cfbb08">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f100f055-70c8-4127-8bce-65a13d70ee94" type="checkbox" ><label class="sk-toggleable__label" for="f100f055-70c8-4127-8bce-65a13d70ee94">pipeline-2</label><div class="sk-toggleable__content"><pre>Index(['Alley', 'Bldg Type', 'Bsmt Cond', 'Bsmt Exposure', 'Bsmt Qual',
       'BsmtFin Type 1', 'BsmtFin Type 2', 'Central Air', 'Condition 1',
       'Condition 2', 'Electrical', 'Exter Cond', 'Exter Qual', 'Exterior 1st',
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9b128bdc-d2b9-49f2-a3e6-b25bcd163f8c" type="checkbox" ><label class="sk-toggleable__label" for="9b128bdc-d2b9-49f2-a3e6-b25bcd163f8c">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="efe52442-7cb5-4ae2-bef4-1e4e2b23b1f1" type="checkbox" ><label class="sk-toggleable__label" for="efe52442-7cb5-4ae2-bef4-1e4e2b23b1f1">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[Index(['Grvl', 'Pave', 'not present', 'missing'], dtype='object'),
                           Index(['1Fam', '2fmCon', 'Duplex', 'Twnhs', 'TwnhsE', 'missing'], dtype='object'),
                           Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtype='object'),
                           Index(['Av', 'Gd', 'Mn', 'No', 'missing'], dtype='object'),
                           Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtyp...
                           Index(['1.5Fin', '1.5Unf', '1Story', '2.5Fin', '2.5Unf', '2Story', 'SFoyer',
       'SLvl', 'missing'],
      dtype='object'),
                           Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'missing'], dtype='object'),
                           Index(['Bnk', 'HLS', 'Low', 'Lvl', 'missing'], dtype='object'),
                           Index(['Gtl', 'Mod', 'Sev', 'missing'], dtype='object'),
                           Index(['Corner', 'CulDSac', 'FR2', 'FR3', 'Inside', 'missing'], dtype='object'), ...])</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7945cbe4-08e0-43a3-b488-ba594149cd94" type="checkbox" ><label class="sk-toggleable__label" for="7945cbe4-08e0-43a3-b488-ba594149cd94">XGBRegressor</label><div class="sk-toggleable__content"><pre>XGBRegressor(base_score=None, booster=None, colsample_bylevel=None,
             colsample_bynode=None, colsample_bytree=None, gamma=None,
             gpu_id=None, importance_type='gain', interaction_constraints=None,
             learning_rate=None, max_delta_step=None, max_depth=None,
             min_child_weight=None, missing=nan, monotone_constraints=None,
             n_estimators=100, n_jobs=None, num_parallel_tree=None,
             random_state=None, reg_alpha=None, reg_lambda=None,
             scale_pos_weight=None, subsample=None, tree_method=None,
             validate_parameters=None, verbosity=None)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get best parameters and train full XGBoost with larger number of estimators</span>
<span class="n">xgb_best_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;xgb__n_estimators&#39;</span><span class="p">}</span>
<span class="n">xgb_best</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="n">prepare_nonlinear</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;xgb&#39;</span><span class="p">,</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="o">**</span><span class="n">xgb_best_params</span><span class="p">))</span>
<span class="p">])</span>
<span class="n">xgb_best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;colsample_bytree&#39;: 0.3,
 &#39;eval_metric&#39;: &#39;rmse&#39;,
 &#39;gamma&#39;: 0.1,
 &#39;learning_rate&#39;: 0.1,
 &#39;max_depth&#39;: 5,
 &#39;min_child_weight&#39;: 2,
 &#39;objective&#39;: &#39;reg:squarederror&#39;,
 &#39;reg_alpha&#39;: 0.1,
 &#39;reg_lambda&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">xgb_cv</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">xgb_best</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1min 44s, sys: 928 ms, total: 1min 45s
Wall time: 15.2 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cv_scores</span><span class="p">(</span><span class="n">xgb_cv</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_58_0.png" src="../../_images/ames-housing_58_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb_best_model</span><span class="p">,</span> <span class="n">xgb_rmsle</span> <span class="o">=</span> <span class="n">get_best_model</span><span class="p">(</span><span class="n">xgb_cv</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best XGBoost model:</span><span class="se">\n</span><span class="s2">  RMLSE: </span><span class="si">{</span><span class="n">xgb_rmsle</span><span class="si">:</span><span class="s2">0.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best XGBoost model:
  RMLSE: 0.14401
</pre></div>
</div>
</div>
</div>
<p>So XGBoost actually doesn’t do better than Lasso, which is surprising. Yet, this result is also confirmed by <a class="reference external" href="https://github.com/Bashkeel/House-Prices">Bashkeel’s solution to Ames Housing</a>. As a final exercise, we are going to use PCA on the numerical columns and revisit linear models to demonstrate a more elaborate pipeline.</p>
</div>
</div>
<div class="section" id="linear-models-revisted">
<h2>Linear models revisted<a class="headerlink" href="#linear-models-revisted" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pca-and-linear-model">
<h3>PCA and linear model<a class="headerlink" href="#pca-and-linear-model" title="Permalink to this headline">¶</a></h3>
<p>We are going to add PCA to our Lasso pipeline, following <a class="reference external" href="https://scikit-learn.org/stable/auto_examples/compose/plot_column_transformer_mixed_types.html">sklearn’s documentation</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocess_num_cols_3</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span>
        <span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span>
        <span class="p">),</span>
    <span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">PCA</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">prepare_pca_lasso</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="p">[(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">preprocess_num_cols_3</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span>
     <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">preprocess_cat_cols</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">)],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span>
<span class="p">)</span>

<span class="n">pca_lasso</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span> <span class="n">prepare_pca_lasso</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">pca_lasso_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;prep__num__pca__n_components&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.0001</span><span class="p">,</span> <span class="mf">.0002</span><span class="p">,</span> <span class="mf">.0005</span><span class="p">,</span> <span class="mf">.001</span><span class="p">,</span> <span class="mf">.002</span><span class="p">,</span> <span class="mf">.005</span> <span class="p">],</span>
    <span class="s1">&#39;lasso__selection&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]}</span>
<span class="n">search_pca_lasso</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pca_lasso</span><span class="p">,</span> <span class="n">pca_lasso_params</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="221abe14-eefb-4099-91f0-9ac3a86ba3c4" type="checkbox" ><label class="sk-toggleable__label" for="221abe14-eefb-4099-91f0-9ac3a86ba3c4">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(estimator=Pipeline(steps=[('prep',
                                        ColumnTransformer(transformers=[('num',
                                                                         Pipeline(steps=[('simpleimputer',
                                                                                          SimpleImputer(strategy='median')),
                                                                                         ('standardscaler',
                                                                                          StandardScaler()),
                                                                                         ('pca',
                                                                                          PCA())]),
                                                                         Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fire...
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object'))])),
                                       ('lasso', Lasso())]),
             n_jobs=-1,
             param_grid={'lasso__alpha': [0.0001, 0.0002, 0.0005, 0.001, 0.002,
                                          0.005],
                         'lasso__selection': ['random'],
                         'prep__num__pca__n_components': [8, 12, 16, 20]},
             scoring='neg_mean_squared_error')</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="92ad208a-ef8f-4d54-8243-9278b4e7986f" type="checkbox" ><label class="sk-toggleable__label" for="92ad208a-ef8f-4d54-8243-9278b4e7986f">prep: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler()),
                                                 ('pca', PCA())]),
                                 Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'G...
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object'))])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2f95e21a-e3ab-4753-a552-fb3b10820ab2" type="checkbox" ><label class="sk-toggleable__label" for="2f95e21a-e3ab-4753-a552-fb3b10820ab2">num</label><div class="sk-toggleable__content"><pre>Index(['1st Flr SF', '2nd Flr SF', '3Ssn Porch', 'Bedroom AbvGr',
       'Bsmt Full Bath', 'Bsmt Half Bath', 'Bsmt Unf SF', 'BsmtFin SF 1',
       'BsmtFin SF 2', 'Enclosed Porch', 'Fireplaces', 'Full Bath',
       'Garage Area', 'Garage Cars', 'Garage Yr Blt', 'Gr Liv Area',
       'Half Bath', 'Kitchen AbvGr', 'Lot Area', 'Lot Frontage',
       'Low Qual Fin SF', 'MS SubClass', 'Mas Vnr Area', 'Misc Val', 'Mo Sold',
       'Open Porch SF', 'Order', 'Overall Cond', 'Overall Qual', 'PID',
       'Pool Area', 'Screen Porch', 'TotRms AbvGrd', 'Total Bsmt SF',
       'Wood Deck SF', 'Year Built', 'Year Remod/Add', 'Yr Sold'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4315e014-01c9-433c-bf80-37064129aebf" type="checkbox" ><label class="sk-toggleable__label" for="4315e014-01c9-433c-bf80-37064129aebf">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c33bae6d-cd94-4c66-9409-8d0807c5ff4f" type="checkbox" ><label class="sk-toggleable__label" for="c33bae6d-cd94-4c66-9409-8d0807c5ff4f">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="95b25225-200d-4fcc-8a96-4dc5c0b1eaa3" type="checkbox" ><label class="sk-toggleable__label" for="95b25225-200d-4fcc-8a96-4dc5c0b1eaa3">PCA</label><div class="sk-toggleable__content"><pre>PCA()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2a85cadc-da59-4b49-af4f-55df331da4ea" type="checkbox" ><label class="sk-toggleable__label" for="2a85cadc-da59-4b49-af4f-55df331da4ea">cat</label><div class="sk-toggleable__content"><pre>Index(['Alley', 'Bldg Type', 'Bsmt Cond', 'Bsmt Exposure', 'Bsmt Qual',
       'BsmtFin Type 1', 'BsmtFin Type 2', 'Central Air', 'Condition 1',
       'Condition 2', 'Electrical', 'Exter Cond', 'Exter Qual', 'Exterior 1st',
       'Exterior 2nd', 'Fence', 'Fireplace Qu', 'Foundation', 'Functional',
       'Garage Cond', 'Garage Finish', 'Garage Qual', 'Garage Type', 'Heating',
       'Heating QC', 'House Style', 'Kitchen Qual', 'Land Contour',
       'Land Slope', 'Lot Config', 'Lot Shape', 'MS Zoning', 'Mas Vnr Type',
       'Misc Feature', 'Neighborhood', 'Paved Drive', 'Pool QC', 'Roof Matl',
       'Roof Style', 'Sale Condition', 'Sale Type', 'Street', 'Utilities'],
      dtype='object')</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fee6d241-9986-4065-be75-77c22bceebb5" type="checkbox" ><label class="sk-toggleable__label" for="fee6d241-9986-4065-be75-77c22bceebb5">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f12dfd87-f241-4ff0-80bd-1a84a7f90a4e" type="checkbox" ><label class="sk-toggleable__label" for="f12dfd87-f241-4ff0-80bd-1a84a7f90a4e">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(categories=[Index(['Grvl', 'Pave', 'not present', 'missing'], dtype='object'),
                          Index(['1Fam', '2fmCon', 'Duplex', 'Twnhs', 'TwnhsE', 'missing'], dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtype='object'),
                          Index(['Av', 'Gd', 'Mn', 'No', 'missing'], dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'not present', 'missing'], dtype...
                          Index(['1.5Fin', '1.5Unf', '1Story', '2.5Fin', '2.5Unf', '2Story', 'SFoyer',
       'SLvl', 'missing'],
      dtype='object'),
                          Index(['Ex', 'Fa', 'Gd', 'Po', 'TA', 'missing'], dtype='object'),
                          Index(['Bnk', 'HLS', 'Low', 'Lvl', 'missing'], dtype='object'),
                          Index(['Gtl', 'Mod', 'Sev', 'missing'], dtype='object'),
                          Index(['Corner', 'CulDSac', 'FR2', 'FR3', 'Inside', 'missing'], dtype='object'), ...])</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b308760c-77d2-49be-ae10-9d79d1c7d99e" type="checkbox" ><label class="sk-toggleable__label" for="b308760c-77d2-49be-ae10-9d79d1c7d99e">Lasso</label><div class="sk-toggleable__content"><pre>Lasso()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;lasso__alpha&#39;: 0.0002,
 &#39;lasso__selection&#39;: &#39;random&#39;,
 &#39;prep__num__pca__n_components&#39;: 20}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;rmsle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cv_results</span><span class="o">.</span><span class="n">mean_test_score</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cv_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;param_lasso__alpha&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rmsle&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;param_prep__num__pca__n_components&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_66_0.png" src="../../_images/ames-housing_66_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca_lasso_rmsle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Results PCA - Lasso:</span>
<span class="s2">  RMSLE: </span><span class="si">{</span><span class="n">pca_lasso_rmsle</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  Leaderboard </span><span class="si">{</span><span class="n">leaderboard</span><span class="o">.</span><span class="n">Score</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">pca_lasso_rmsle</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  Test score: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span><span class="si">}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results PCA - Lasso:
  RMSLE: 0.11010899737867327
  Leaderboard 133
  Test score: 0.14375396943292268
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># table with num_cols and component coefficients</span>
<span class="n">pca_</span> <span class="o">=</span> <span class="n">search_pca_lasso</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">[</span><span class="s1">&#39;prep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">][</span><span class="s1">&#39;pca&#39;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca_</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">num_cols</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>13</th>
      <th>14</th>
      <th>15</th>
      <th>16</th>
      <th>17</th>
      <th>18</th>
      <th>19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1st Flr SF</th>
      <td>0.254</td>
      <td>-0.137</td>
      <td>0.288</td>
      <td>-0.185</td>
      <td>-0.023</td>
      <td>0.156</td>
      <td>0.043</td>
      <td>0.032</td>
      <td>0.102</td>
      <td>0.074</td>
      <td>-0.009</td>
      <td>0.011</td>
      <td>0.040</td>
      <td>-0.012</td>
      <td>0.048</td>
      <td>0.009</td>
      <td>-0.011</td>
      <td>-0.083</td>
      <td>-0.020</td>
      <td>-0.006</td>
    </tr>
    <tr>
      <th>2nd Flr SF</th>
      <td>0.103</td>
      <td>0.426</td>
      <td>-0.118</td>
      <td>0.270</td>
      <td>0.080</td>
      <td>-0.115</td>
      <td>-0.039</td>
      <td>-0.059</td>
      <td>-0.021</td>
      <td>-0.044</td>
      <td>-0.010</td>
      <td>0.019</td>
      <td>-0.041</td>
      <td>-0.014</td>
      <td>0.041</td>
      <td>-0.016</td>
      <td>-0.017</td>
      <td>-0.012</td>
      <td>0.017</td>
      <td>-0.059</td>
    </tr>
    <tr>
      <th>3Ssn Porch</th>
      <td>0.003</td>
      <td>-0.050</td>
      <td>0.017</td>
      <td>-0.045</td>
      <td>0.016</td>
      <td>-0.011</td>
      <td>0.052</td>
      <td>-0.008</td>
      <td>0.325</td>
      <td>-0.274</td>
      <td>0.320</td>
      <td>-0.195</td>
      <td>-0.464</td>
      <td>0.264</td>
      <td>0.518</td>
      <td>-0.135</td>
      <td>0.194</td>
      <td>0.051</td>
      <td>0.173</td>
      <td>-0.085</td>
    </tr>
    <tr>
      <th>Bedroom AbvGr</th>
      <td>0.095</td>
      <td>0.372</td>
      <td>0.167</td>
      <td>-0.012</td>
      <td>0.058</td>
      <td>0.073</td>
      <td>-0.013</td>
      <td>0.120</td>
      <td>-0.110</td>
      <td>-0.057</td>
      <td>0.161</td>
      <td>-0.111</td>
      <td>-0.010</td>
      <td>-0.077</td>
      <td>-0.091</td>
      <td>-0.085</td>
      <td>0.091</td>
      <td>-0.059</td>
      <td>-0.190</td>
      <td>-0.203</td>
    </tr>
    <tr>
      <th>Bsmt Full Bath</th>
      <td>0.090</td>
      <td>-0.277</td>
      <td>0.104</td>
      <td>0.310</td>
      <td>0.112</td>
      <td>0.285</td>
      <td>-0.002</td>
      <td>-0.206</td>
      <td>-0.141</td>
      <td>0.054</td>
      <td>0.047</td>
      <td>-0.108</td>
      <td>-0.005</td>
      <td>-0.015</td>
      <td>0.083</td>
      <td>0.038</td>
      <td>-0.001</td>
      <td>-0.018</td>
      <td>-0.088</td>
      <td>-0.068</td>
    </tr>
    <tr>
      <th>Bsmt Half Bath</th>
      <td>-0.020</td>
      <td>-0.030</td>
      <td>0.080</td>
      <td>0.059</td>
      <td>-0.010</td>
      <td>-0.100</td>
      <td>0.111</td>
      <td>0.506</td>
      <td>0.432</td>
      <td>-0.133</td>
      <td>-0.002</td>
      <td>0.091</td>
      <td>-0.066</td>
      <td>-0.104</td>
      <td>-0.354</td>
      <td>-0.424</td>
      <td>-0.154</td>
      <td>0.123</td>
      <td>-0.134</td>
      <td>-0.026</td>
    </tr>
    <tr>
      <th>Bsmt Unf SF</th>
      <td>0.102</td>
      <td>0.153</td>
      <td>-0.030</td>
      <td>-0.540</td>
      <td>-0.164</td>
      <td>-0.054</td>
      <td>0.024</td>
      <td>-0.007</td>
      <td>0.106</td>
      <td>0.092</td>
      <td>-0.094</td>
      <td>0.068</td>
      <td>0.085</td>
      <td>0.015</td>
      <td>0.106</td>
      <td>0.099</td>
      <td>0.002</td>
      <td>-0.151</td>
      <td>0.085</td>
      <td>0.012</td>
    </tr>
    <tr>
      <th>BsmtFin SF 1</th>
      <td>0.139</td>
      <td>-0.307</td>
      <td>0.141</td>
      <td>0.292</td>
      <td>0.107</td>
      <td>0.212</td>
      <td>-0.138</td>
      <td>-0.105</td>
      <td>0.064</td>
      <td>-0.066</td>
      <td>0.157</td>
      <td>0.123</td>
      <td>-0.087</td>
      <td>0.041</td>
      <td>-0.160</td>
      <td>-0.061</td>
      <td>-0.009</td>
      <td>-0.042</td>
      <td>-0.202</td>
      <td>-0.093</td>
    </tr>
    <tr>
      <th>BsmtFin SF 2</th>
      <td>-0.001</td>
      <td>-0.068</td>
      <td>0.144</td>
      <td>0.155</td>
      <td>0.041</td>
      <td>-0.035</td>
      <td>0.267</td>
      <td>0.243</td>
      <td>-0.123</td>
      <td>0.199</td>
      <td>-0.259</td>
      <td>-0.508</td>
      <td>0.271</td>
      <td>-0.149</td>
      <td>0.313</td>
      <td>-0.281</td>
      <td>0.021</td>
      <td>0.159</td>
      <td>0.126</td>
      <td>-0.040</td>
    </tr>
    <tr>
      <th>Enclosed Porch</th>
      <td>-0.095</td>
      <td>0.115</td>
      <td>0.196</td>
      <td>-0.018</td>
      <td>0.036</td>
      <td>0.003</td>
      <td>-0.025</td>
      <td>-0.311</td>
      <td>0.126</td>
      <td>-0.183</td>
      <td>-0.322</td>
      <td>0.154</td>
      <td>0.185</td>
      <td>0.122</td>
      <td>0.178</td>
      <td>-0.073</td>
      <td>-0.328</td>
      <td>0.296</td>
      <td>-0.107</td>
      <td>-0.255</td>
    </tr>
    <tr>
      <th>Fireplaces</th>
      <td>0.177</td>
      <td>-0.018</td>
      <td>0.197</td>
      <td>0.171</td>
      <td>0.070</td>
      <td>-0.119</td>
      <td>-0.074</td>
      <td>0.020</td>
      <td>0.227</td>
      <td>0.032</td>
      <td>-0.162</td>
      <td>0.080</td>
      <td>-0.036</td>
      <td>0.090</td>
      <td>0.083</td>
      <td>0.092</td>
      <td>-0.188</td>
      <td>-0.204</td>
      <td>0.262</td>
      <td>0.015</td>
    </tr>
    <tr>
      <th>Full Bath</th>
      <td>0.257</td>
      <td>0.165</td>
      <td>-0.102</td>
      <td>-0.093</td>
      <td>-0.022</td>
      <td>0.142</td>
      <td>0.131</td>
      <td>0.007</td>
      <td>0.061</td>
      <td>0.001</td>
      <td>0.066</td>
      <td>0.002</td>
      <td>-0.041</td>
      <td>-0.072</td>
      <td>-0.033</td>
      <td>-0.030</td>
      <td>-0.064</td>
      <td>0.051</td>
      <td>0.048</td>
      <td>-0.070</td>
    </tr>
    <tr>
      <th>Garage Area</th>
      <td>0.281</td>
      <td>-0.078</td>
      <td>0.016</td>
      <td>-0.005</td>
      <td>-0.015</td>
      <td>-0.068</td>
      <td>-0.043</td>
      <td>-0.059</td>
      <td>-0.050</td>
      <td>-0.200</td>
      <td>-0.112</td>
      <td>0.044</td>
      <td>0.008</td>
      <td>-0.079</td>
      <td>-0.021</td>
      <td>0.053</td>
      <td>0.068</td>
      <td>0.452</td>
      <td>0.095</td>
      <td>0.169</td>
    </tr>
    <tr>
      <th>Garage Cars</th>
      <td>0.293</td>
      <td>-0.047</td>
      <td>-0.038</td>
      <td>0.014</td>
      <td>-0.020</td>
      <td>-0.063</td>
      <td>-0.034</td>
      <td>-0.042</td>
      <td>-0.045</td>
      <td>-0.207</td>
      <td>-0.113</td>
      <td>0.047</td>
      <td>0.003</td>
      <td>-0.079</td>
      <td>-0.008</td>
      <td>0.065</td>
      <td>0.051</td>
      <td>0.428</td>
      <td>0.116</td>
      <td>0.151</td>
    </tr>
    <tr>
      <th>Garage Yr Blt</th>
      <td>0.239</td>
      <td>-0.103</td>
      <td>-0.322</td>
      <td>-0.052</td>
      <td>-0.080</td>
      <td>0.026</td>
      <td>0.122</td>
      <td>-0.016</td>
      <td>-0.083</td>
      <td>0.034</td>
      <td>0.036</td>
      <td>-0.069</td>
      <td>-0.070</td>
      <td>0.019</td>
      <td>-0.142</td>
      <td>-0.059</td>
      <td>0.003</td>
      <td>0.071</td>
      <td>0.029</td>
      <td>-0.136</td>
    </tr>
    <tr>
      <th>Gr Liv Area</th>
      <td>0.288</td>
      <td>0.275</td>
      <td>0.129</td>
      <td>0.087</td>
      <td>0.053</td>
      <td>0.027</td>
      <td>0.014</td>
      <td>-0.055</td>
      <td>0.077</td>
      <td>0.042</td>
      <td>-0.031</td>
      <td>-0.004</td>
      <td>-0.009</td>
      <td>0.034</td>
      <td>0.028</td>
      <td>-0.015</td>
      <td>0.005</td>
      <td>-0.059</td>
      <td>-0.004</td>
      <td>-0.043</td>
    </tr>
    <tr>
      <th>Half Bath</th>
      <td>0.131</td>
      <td>0.220</td>
      <td>-0.167</td>
      <td>0.286</td>
      <td>0.091</td>
      <td>-0.183</td>
      <td>-0.190</td>
      <td>0.055</td>
      <td>-0.149</td>
      <td>-0.012</td>
      <td>-0.030</td>
      <td>-0.025</td>
      <td>-0.009</td>
      <td>0.114</td>
      <td>0.076</td>
      <td>-0.067</td>
      <td>0.009</td>
      <td>-0.100</td>
      <td>0.018</td>
      <td>-0.037</td>
    </tr>
    <tr>
      <th>Kitchen AbvGr</th>
      <td>-0.006</td>
      <td>0.183</td>
      <td>0.064</td>
      <td>-0.083</td>
      <td>0.038</td>
      <td>0.579</td>
      <td>0.077</td>
      <td>0.122</td>
      <td>-0.042</td>
      <td>-0.019</td>
      <td>0.159</td>
      <td>0.031</td>
      <td>0.057</td>
      <td>-0.192</td>
      <td>0.066</td>
      <td>0.081</td>
      <td>0.088</td>
      <td>0.148</td>
      <td>0.044</td>
      <td>0.217</td>
    </tr>
    <tr>
      <th>Lot Area</th>
      <td>0.100</td>
      <td>-0.008</td>
      <td>0.298</td>
      <td>0.018</td>
      <td>0.031</td>
      <td>-0.125</td>
      <td>0.124</td>
      <td>0.011</td>
      <td>-0.210</td>
      <td>-0.138</td>
      <td>0.077</td>
      <td>0.129</td>
      <td>-0.114</td>
      <td>0.056</td>
      <td>-0.140</td>
      <td>-0.112</td>
      <td>-0.153</td>
      <td>-0.166</td>
      <td>0.403</td>
      <td>0.459</td>
    </tr>
    <tr>
      <th>Lot Frontage</th>
      <td>0.138</td>
      <td>0.003</td>
      <td>0.299</td>
      <td>-0.133</td>
      <td>0.042</td>
      <td>-0.173</td>
      <td>-0.053</td>
      <td>0.016</td>
      <td>-0.328</td>
      <td>-0.128</td>
      <td>0.130</td>
      <td>-0.066</td>
      <td>-0.117</td>
      <td>-0.028</td>
      <td>-0.085</td>
      <td>0.037</td>
      <td>0.080</td>
      <td>0.123</td>
      <td>-0.126</td>
      <td>-0.019</td>
    </tr>
    <tr>
      <th>Low Qual Fin SF</th>
      <td>-0.017</td>
      <td>0.101</td>
      <td>0.073</td>
      <td>-0.040</td>
      <td>0.007</td>
      <td>0.049</td>
      <td>0.148</td>
      <td>-0.283</td>
      <td>0.161</td>
      <td>0.221</td>
      <td>-0.153</td>
      <td>-0.299</td>
      <td>-0.047</td>
      <td>0.560</td>
      <td>-0.446</td>
      <td>-0.080</td>
      <td>0.282</td>
      <td>0.161</td>
      <td>-0.029</td>
      <td>0.138</td>
    </tr>
    <tr>
      <th>MS SubClass</th>
      <td>-0.017</td>
      <td>0.139</td>
      <td>-0.281</td>
      <td>0.232</td>
      <td>0.017</td>
      <td>0.388</td>
      <td>0.050</td>
      <td>0.052</td>
      <td>0.261</td>
      <td>0.082</td>
      <td>-0.107</td>
      <td>0.144</td>
      <td>0.033</td>
      <td>0.025</td>
      <td>0.053</td>
      <td>0.045</td>
      <td>-0.036</td>
      <td>0.049</td>
      <td>0.158</td>
      <td>0.270</td>
    </tr>
    <tr>
      <th>Mas Vnr Area</th>
      <td>0.201</td>
      <td>-0.042</td>
      <td>0.044</td>
      <td>0.044</td>
      <td>0.025</td>
      <td>0.012</td>
      <td>-0.247</td>
      <td>0.110</td>
      <td>0.103</td>
      <td>-0.063</td>
      <td>-0.157</td>
      <td>0.158</td>
      <td>0.172</td>
      <td>0.075</td>
      <td>0.033</td>
      <td>-0.017</td>
      <td>0.224</td>
      <td>-0.183</td>
      <td>-0.119</td>
      <td>0.046</td>
    </tr>
    <tr>
      <th>Misc Val</th>
      <td>-0.008</td>
      <td>0.001</td>
      <td>0.029</td>
      <td>0.017</td>
      <td>0.055</td>
      <td>-0.085</td>
      <td>0.060</td>
      <td>0.021</td>
      <td>-0.056</td>
      <td>0.243</td>
      <td>0.542</td>
      <td>0.359</td>
      <td>0.467</td>
      <td>0.292</td>
      <td>0.062</td>
      <td>-0.172</td>
      <td>0.011</td>
      <td>0.248</td>
      <td>0.226</td>
      <td>-0.169</td>
    </tr>
    <tr>
      <th>Mo Sold</th>
      <td>0.023</td>
      <td>0.032</td>
      <td>0.026</td>
      <td>0.050</td>
      <td>-0.185</td>
      <td>0.049</td>
      <td>-0.085</td>
      <td>0.069</td>
      <td>0.142</td>
      <td>-0.235</td>
      <td>0.283</td>
      <td>-0.465</td>
      <td>0.226</td>
      <td>0.125</td>
      <td>-0.169</td>
      <td>0.410</td>
      <td>-0.497</td>
      <td>0.012</td>
      <td>0.064</td>
      <td>-0.041</td>
    </tr>
    <tr>
      <th>Open Porch SF</th>
      <td>0.138</td>
      <td>0.047</td>
      <td>0.010</td>
      <td>0.014</td>
      <td>-0.044</td>
      <td>-0.087</td>
      <td>-0.008</td>
      <td>-0.196</td>
      <td>-0.022</td>
      <td>0.446</td>
      <td>0.153</td>
      <td>-0.063</td>
      <td>-0.176</td>
      <td>-0.043</td>
      <td>0.144</td>
      <td>-0.243</td>
      <td>-0.433</td>
      <td>-0.020</td>
      <td>-0.235</td>
      <td>0.357</td>
    </tr>
    <tr>
      <th>Order</th>
      <td>-0.021</td>
      <td>0.035</td>
      <td>0.106</td>
      <td>0.191</td>
      <td>-0.648</td>
      <td>0.016</td>
      <td>0.008</td>
      <td>-0.054</td>
      <td>-0.032</td>
      <td>-0.005</td>
      <td>0.010</td>
      <td>0.067</td>
      <td>-0.010</td>
      <td>-0.027</td>
      <td>0.025</td>
      <td>-0.075</td>
      <td>0.111</td>
      <td>-0.010</td>
      <td>-0.005</td>
      <td>-0.018</td>
    </tr>
    <tr>
      <th>Overall Cond</th>
      <td>-0.102</td>
      <td>0.014</td>
      <td>0.105</td>
      <td>0.114</td>
      <td>0.092</td>
      <td>-0.300</td>
      <td>0.229</td>
      <td>-0.226</td>
      <td>0.334</td>
      <td>-0.052</td>
      <td>0.224</td>
      <td>-0.013</td>
      <td>0.202</td>
      <td>-0.336</td>
      <td>0.051</td>
      <td>0.189</td>
      <td>0.243</td>
      <td>0.024</td>
      <td>-0.257</td>
      <td>0.260</td>
    </tr>
    <tr>
      <th>Overall Qual</th>
      <td>0.297</td>
      <td>-0.039</td>
      <td>-0.109</td>
      <td>0.001</td>
      <td>-0.029</td>
      <td>-0.107</td>
      <td>0.003</td>
      <td>-0.122</td>
      <td>0.194</td>
      <td>0.029</td>
      <td>-0.074</td>
      <td>0.049</td>
      <td>0.102</td>
      <td>-0.031</td>
      <td>0.078</td>
      <td>0.032</td>
      <td>-0.021</td>
      <td>-0.031</td>
      <td>-0.030</td>
      <td>-0.072</td>
    </tr>
    <tr>
      <th>PID</th>
      <td>-0.129</td>
      <td>0.067</td>
      <td>0.128</td>
      <td>0.040</td>
      <td>-0.055</td>
      <td>0.096</td>
      <td>0.299</td>
      <td>-0.324</td>
      <td>-0.007</td>
      <td>0.004</td>
      <td>-0.047</td>
      <td>0.131</td>
      <td>-0.239</td>
      <td>-0.300</td>
      <td>-0.189</td>
      <td>-0.081</td>
      <td>-0.102</td>
      <td>-0.031</td>
      <td>0.320</td>
      <td>-0.363</td>
    </tr>
    <tr>
      <th>Pool Area</th>
      <td>0.019</td>
      <td>-0.000</td>
      <td>0.107</td>
      <td>0.090</td>
      <td>-0.033</td>
      <td>-0.069</td>
      <td>0.331</td>
      <td>0.330</td>
      <td>-0.064</td>
      <td>0.272</td>
      <td>-0.081</td>
      <td>0.249</td>
      <td>-0.328</td>
      <td>0.199</td>
      <td>0.125</td>
      <td>0.474</td>
      <td>-0.112</td>
      <td>0.235</td>
      <td>-0.262</td>
      <td>-0.087</td>
    </tr>
    <tr>
      <th>Screen Porch</th>
      <td>0.032</td>
      <td>-0.013</td>
      <td>0.149</td>
      <td>0.087</td>
      <td>0.014</td>
      <td>-0.119</td>
      <td>-0.378</td>
      <td>0.086</td>
      <td>0.207</td>
      <td>0.458</td>
      <td>0.050</td>
      <td>-0.112</td>
      <td>-0.118</td>
      <td>-0.259</td>
      <td>-0.139</td>
      <td>0.241</td>
      <td>0.185</td>
      <td>0.149</td>
      <td>0.356</td>
      <td>-0.166</td>
    </tr>
    <tr>
      <th>TotRms AbvGrd</th>
      <td>0.212</td>
      <td>0.354</td>
      <td>0.161</td>
      <td>0.010</td>
      <td>0.046</td>
      <td>0.104</td>
      <td>0.024</td>
      <td>0.006</td>
      <td>-0.016</td>
      <td>-0.013</td>
      <td>0.065</td>
      <td>-0.034</td>
      <td>-0.004</td>
      <td>-0.022</td>
      <td>-0.015</td>
      <td>-0.013</td>
      <td>0.085</td>
      <td>-0.038</td>
      <td>-0.120</td>
      <td>-0.067</td>
    </tr>
    <tr>
      <th>Total Bsmt SF</th>
      <td>0.255</td>
      <td>-0.194</td>
      <td>0.177</td>
      <td>-0.195</td>
      <td>-0.041</td>
      <td>0.154</td>
      <td>-0.013</td>
      <td>-0.020</td>
      <td>0.129</td>
      <td>0.107</td>
      <td>-0.038</td>
      <td>-0.006</td>
      <td>0.108</td>
      <td>-0.001</td>
      <td>0.069</td>
      <td>-0.075</td>
      <td>0.002</td>
      <td>-0.138</td>
      <td>-0.074</td>
      <td>-0.103</td>
    </tr>
    <tr>
      <th>Wood Deck SF</th>
      <td>0.131</td>
      <td>-0.067</td>
      <td>0.031</td>
      <td>0.185</td>
      <td>0.042</td>
      <td>-0.060</td>
      <td>0.481</td>
      <td>0.091</td>
      <td>-0.048</td>
      <td>-0.107</td>
      <td>-0.067</td>
      <td>0.027</td>
      <td>0.193</td>
      <td>0.131</td>
      <td>-0.037</td>
      <td>0.200</td>
      <td>0.139</td>
      <td>-0.307</td>
      <td>0.117</td>
      <td>-0.055</td>
    </tr>
    <tr>
      <th>Year Built</th>
      <td>0.260</td>
      <td>-0.167</td>
      <td>-0.301</td>
      <td>-0.021</td>
      <td>-0.065</td>
      <td>-0.008</td>
      <td>0.014</td>
      <td>0.117</td>
      <td>-0.130</td>
      <td>0.010</td>
      <td>0.036</td>
      <td>-0.040</td>
      <td>-0.052</td>
      <td>0.013</td>
      <td>-0.060</td>
      <td>-0.074</td>
      <td>-0.035</td>
      <td>-0.008</td>
      <td>0.020</td>
      <td>-0.124</td>
    </tr>
    <tr>
      <th>Year Remod/Add</th>
      <td>0.220</td>
      <td>-0.058</td>
      <td>-0.264</td>
      <td>-0.012</td>
      <td>-0.022</td>
      <td>-0.141</td>
      <td>0.252</td>
      <td>-0.194</td>
      <td>0.090</td>
      <td>0.035</td>
      <td>0.150</td>
      <td>-0.049</td>
      <td>-0.008</td>
      <td>-0.203</td>
      <td>-0.064</td>
      <td>-0.001</td>
      <td>-0.012</td>
      <td>-0.027</td>
      <td>-0.065</td>
      <td>-0.059</td>
    </tr>
    <tr>
      <th>Yr Sold</th>
      <td>-0.008</td>
      <td>-0.032</td>
      <td>-0.078</td>
      <td>-0.185</td>
      <td>0.651</td>
      <td>0.007</td>
      <td>0.044</td>
      <td>0.001</td>
      <td>0.024</td>
      <td>0.009</td>
      <td>-0.014</td>
      <td>-0.042</td>
      <td>-0.040</td>
      <td>-0.025</td>
      <td>-0.064</td>
      <td>0.053</td>
      <td>-0.122</td>
      <td>0.004</td>
      <td>0.059</td>
      <td>-0.049</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># taken from https://stackoverflow.com/a/46766116/3197404</span>
<span class="k">def</span> <span class="nf">biplot</span><span class="p">(</span><span class="n">score</span><span class="p">,</span><span class="n">coeff</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot_pc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">score</span><span class="p">[:,</span><span class="n">plot_pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">score</span><span class="p">[:,</span><span class="n">plot_pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">coeff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scalex</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">scaley</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span> <span class="o">*</span> <span class="n">scalex</span><span class="p">,</span><span class="n">ys</span> <span class="o">*</span> <span class="n">scaley</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s2">&quot;Var&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;PC</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;PC</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_pca</span> <span class="o">=</span> <span class="n">preprocess_num_cols_3</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">num_cols</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">biplot</span><span class="p">(</span><span class="n">x_pca</span><span class="p">[:,:],</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">pca_</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">labels</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span> <span class="n">plot_pc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_70_0.png" src="../../_images/ames-housing_70_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">biplot</span><span class="p">(</span><span class="n">x_pca</span><span class="p">[:,:],</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">pca_</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">labels</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span> <span class="n">plot_pc</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_71_0.png" src="../../_images/ames-housing_71_0.png" />
</div>
</div>
</div>
<div class="section" id="does-it-help-to-use-separate-linear-models">
<h3>Does it help to use separate linear models?<a class="headerlink" href="#does-it-help-to-use-separate-linear-models" title="Permalink to this headline">¶</a></h3>
<p>Going back to <code class="docutils literal notranslate"><span class="pre">Sale</span> <span class="pre">Condition</span></code>, we are going to build 3 separate linear models and see whether that gives a better result. Curious to see what happens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sale_condition_other</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AdjLand&#39;</span><span class="p">,</span> <span class="s1">&#39;Alloca&#39;</span><span class="p">,</span> <span class="s1">&#39;Family&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">)[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>Sale Condition</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Abnorml</th>
      <td>189.0</td>
      <td>137197.29</td>
      <td>67459.95</td>
      <td>12789.0</td>
      <td>98600.0</td>
      <td>129000.0</td>
      <td>158900.0</td>
      <td>552000.0</td>
    </tr>
    <tr>
      <th>AdjLand</th>
      <td>12.0</td>
      <td>108916.67</td>
      <td>21988.46</td>
      <td>81000.0</td>
      <td>89500.0</td>
      <td>110000.0</td>
      <td>126375.0</td>
      <td>150000.0</td>
    </tr>
    <tr>
      <th>Alloca</th>
      <td>24.0</td>
      <td>161843.71</td>
      <td>72213.54</td>
      <td>50138.0</td>
      <td>117574.0</td>
      <td>149617.0</td>
      <td>202043.0</td>
      <td>359100.0</td>
    </tr>
    <tr>
      <th>Family</th>
      <td>46.0</td>
      <td>157488.59</td>
      <td>63376.52</td>
      <td>79275.0</td>
      <td>121025.0</td>
      <td>144400.0</td>
      <td>174000.0</td>
      <td>409900.0</td>
    </tr>
    <tr>
      <th>Normal</th>
      <td>2412.0</td>
      <td>175327.41</td>
      <td>70006.31</td>
      <td>35000.0</td>
      <td>129500.0</td>
      <td>158750.0</td>
      <td>206225.0</td>
      <td>625000.0</td>
    </tr>
    <tr>
      <th>Partial</th>
      <td>242.0</td>
      <td>274579.01</td>
      <td>100020.69</td>
      <td>113000.0</td>
      <td>198111.0</td>
      <td>250290.0</td>
      <td>336850.0</td>
      <td>611657.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">ols_cv</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">ols_models</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;Partial&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;Abnorml&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">{}}</span>

<span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">ols_models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="o">!=</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">condition</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sale_condition_other</span><span class="p">)</span>    
    <span class="n">ols_</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
        <span class="n">prepare_linear</span><span class="p">,</span>
        <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;cv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ols_cv</span><span class="p">(</span><span class="n">ols_</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">ols_best_index_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;cv&#39;</span><span class="p">][</span><span class="s1">&#39;train_neg_mean_squared_error&#39;</span><span class="p">]))</span>
    <span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;estimator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;cv&#39;</span><span class="p">][</span><span class="s1">&#39;estimator&#39;</span><span class="p">][</span><span class="n">ols_best_index_</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">condition</span><span class="p">,</span> <span class="n">ols_score</span> <span class="ow">in</span> <span class="n">ols_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plot_cv_scores</span><span class="p">(</span><span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;cv&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ames-housing_75_0.png" src="../../_images/ames-housing_75_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols_rmsle</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">ols_models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="o">!=</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">condition</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;AdjLand&#39;</span><span class="p">,</span> <span class="s1">&#39;Alloca&#39;</span><span class="p">,</span> <span class="s1">&#39;Familiy&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">])</span>   
    <span class="n">ols_rmsle</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">ols_models</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;estimator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:])))</span>
<span class="n">ols_rmsle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Normal&#39;: 0.09895196401501209,
 &#39;Partial&#39;: 1.787612343242684,
 &#39;Abnorml&#39;: 0.4426869916346495,
 &#39;Other&#39;: 0.257988869076319}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate weighted sum of squares of separate models</span>
<span class="n">condition_counts</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">)[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">other_count</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;Sale Condition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sale_condition_other</span><span class="p">)]</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">total_ols_rmsle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">condition_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;Other&#39;</span>
 <span class="k">else</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">other_count</span>
 <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ols_rmsle</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span><span class="o">/</span><span class="n">condition_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">total_ols_rmsle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5421656464440533
</pre></div>
</div>
</div>
</div>
<p>So this isn’t really useful</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking calculation weighted sum of squares</span>
<span class="n">ols_msle</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ols_rmsle</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">ols_msle</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Normal&#39;: 0.009791491182428247,
 &#39;Partial&#39;: 3.1955578897135997,
 &#39;Abnorml&#39;: 0.1959717725625362,
 &#39;Other&#39;: 0.06655825656727807}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">({</span><span class="n">k</span><span class="p">:(</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">condition_counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;Other&#39;</span>
 <span class="k">else</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">other_count</span><span class="p">)</span>
 <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ols_rmsle</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="n">condition_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5421656464440533
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="concluding-remarks">
<h2>Concluding remarks<a class="headerlink" href="#concluding-remarks" title="Permalink to this headline">¶</a></h2>
<p>Hopefully this notebook has given you some clear pointers how to structure your sklearn pipelines. The models we have developed performed ok, with the validation scores somewhere between the 25% and 50% percentile.</p>
<p>However, all test scores were significantly worse than validation scores. This indicates we still haven’t tackled the overfitting and/or randomness of local solutions in the model properly. It is left as an exercise to further optimize you model to ensure your solutions are stable and generalizable.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./handson-ml2/extra"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="pandas-profiling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Pandas profiling</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pima-indians-diabetes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Pima Indians Diabetes</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Daniel Kapitan<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>